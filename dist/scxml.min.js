(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.scxml=f()}})(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){(function(process){var printTrace=false;var datamodelAccumulator,fnDecAccumulator,documentHasSendAction,documentHasSendActionWithIdlocationAttribute,sendIdAccumulator;function generateFnName(actionType,action){return"$"+actionType+"_line_"+action.$line+"_column_"+action.$column}var FN_ARGS="(_event)";var stripNsPrefixRe=/^(?:{(?:[^}]*)})?(.*)$/;function stripAttrNsPrefix(attrName){var m=attrName.match(stripNsPrefixRe);return m[1]}function generateFnDeclaration(fnName,fnBody,action){if(printTrace)console.log("generateFnDeclaration",fnName,fnBody);return"function "+fnName+FN_ARGS+"{\n"+fnBody.split("\n").map(function(line){return"    "+line}).join("\n")+"\n"+"};\n"+fnName+".tagname='"+action.$type+"';\n"+fnName+".line="+action.$line+";\n"+fnName+".column="+action.$column+";\n"}function generateFnCall(fnName){if(printTrace)console.log("generateFnCall",fnName);return fnName+".apply(this, arguments)"}function generateActionFunction(action){if(printTrace)console.log("generateActionFunction",action);var fnName=generateFnName(action.$type,action);var fnBody=actionTags[action.$type]?actionTags[action.$type](action):actionTags["custom"](action);var fnDec=generateFnDeclaration(fnName,fnBody,action);fnDecAccumulator.push(fnDec);return fnName}function generateExpressionFunction(expressionType,exprObj){if(printTrace)console.log("generateExpressionFunction",expressionType,exprObj);var fnName=generateFnName(expressionType,exprObj);var fnBody="return "+exprObj.expr+";";var fnDec=generateFnDeclaration(fnName,fnBody,exprObj);fnDecAccumulator.push(fnDec);return fnName}function generateAttributeExpression(attrContainer,attrName){if(printTrace)console.log("generateAttributeExpression",attrContainer,attrName);return generateExpressionFunction(stripAttrNsPrefix(attrName),attrContainer[attrName])}var REFERENCE_MARKER="__xx__DELETE_ME__xx__",REFERENCE_MARKER_RE=new RegExp('"'+REFERENCE_MARKER+"(.*)"+REFERENCE_MARKER+'"',"g");function generateDatamodelDeclaration(){return datamodelAccumulator.length?"var "+datamodelAccumulator.map(function(data){return data.id}).join(", ")+";":""}var SERIALIZE_DATAMODEL_FN_NAME="$serializeDatamodel";function generateDatamodelSerializerFn(){return"function "+SERIALIZE_DATAMODEL_FN_NAME+"(){\n"+"   return {\n"+datamodelAccumulator.map(function(data){return'    "'+data.id+'" : '+data.id}).join(",\n")+"\n"+"   };\n"+"}"}var DESERIALIZE_DATAMODEL_FN_NAME="$deserializeDatamodel",DESERIALIZE_DATAMODEL_FN_ARG="$serializedDatamodel";function generateDatamodelDeserializerFn(){return"function "+DESERIALIZE_DATAMODEL_FN_NAME+"("+DESERIALIZE_DATAMODEL_FN_ARG+"){\n"+datamodelAccumulator.map(function(data){return"    "+data.id+" = "+DESERIALIZE_DATAMODEL_FN_ARG+'["'+data.id+'"];'}).join("\n")+"\n"+"    "+EARLY_BINDING_DATAMODEL_GUARD+" = true;\n"+"}"}var EARLY_BINDING_DATAMODEL_FN_NAME="$initEarlyBindingDatamodel";var EARLY_BINDING_DATAMODEL_GUARD="$scion_early_binding_datamodel_has_fired";function generateEarlyBindingDatamodelInitFn(){return datamodelAccumulator.length?"var "+EARLY_BINDING_DATAMODEL_GUARD+"= false;\n"+"function "+EARLY_BINDING_DATAMODEL_FN_NAME+FN_ARGS+"{\n"+"    if(!"+EARLY_BINDING_DATAMODEL_GUARD+"){\n"+datamodelAccumulator.filter(function(data){return data.expr}).map(function(data){return"        "+data.id+" = "+generateFnCall(generateExpressionFunction("data",data.expr))+";\n"}).join("")+"        "+EARLY_BINDING_DATAMODEL_GUARD+" = true; "+"\n"+"    }\n"+"}":""}function generateSmObjectLiteral(rootState){return JSON.stringify(rootState,4,4).replace(REFERENCE_MARKER_RE,"$1")}function dumpFunctionDeclarations(){return fnDecAccumulator.join("\n\n")}function dumpHeader(){var d=new Date;return"//Generated on "+d.toLocaleDateString()+" "+d.toLocaleTimeString()+" by the SCION SCXML compiler"}function generateFactoryFunctionWrapper(o,name){return"(function (_x,_sessionid,_ioprocessors,In){\n"+"   var _name = '"+name+"';"+[o.sendString,o.rootScript,o.datamodelDeclaration,o.sendIdLocationString,o.earlyBindingFnDeclaration,o.datamodelDeserializerFnDeclaration,o.datamodelSerializerFnDeclaration,o.actionFunctionDeclarations,"return "+o.objectLiteralString+";"].join("\n\n").split("\n").map(function(line){return"    "+line}).join("\n")+"})"}function generateModule(rootState,moduleType){if(datamodelAccumulator.length){rootState.onEntry=rootState.onEntry||[];rootState.onEntry=[markAsReference(EARLY_BINDING_DATAMODEL_FN_NAME)].concat(rootState.onEntry)}rootState[DESERIALIZE_DATAMODEL_FN_NAME]=markAsReference(DESERIALIZE_DATAMODEL_FN_NAME);rootState[SERIALIZE_DATAMODEL_FN_NAME]=markAsReference(SERIALIZE_DATAMODEL_FN_NAME);var o={headerString:dumpHeader(),rootScript:rootState.rootScripts?rootState.rootScripts.map(function(s){return s.content}).join("\n"):"",sendString:documentHasSendAction?getDelayInMs.toString():"",sendIdLocationString:documentHasSendActionWithIdlocationAttribute?generateIdlocationGenerator():"",datamodelDeclaration:generateDatamodelDeclaration(),earlyBindingFnDeclaration:generateEarlyBindingDatamodelInitFn(),datamodelDeserializerFnDeclaration:generateDatamodelDeserializerFn(),datamodelSerializerFnDeclaration:generateDatamodelSerializerFn(),actionFunctionDeclarations:dumpFunctionDeclarations()};delete rootState.rootScripts;o.objectLiteralString=generateSmObjectLiteral(rootState);var s=generateFactoryFunctionWrapper(o,rootState.name);var r;switch(moduleType){case"amd":throw new Error("AMD not yet supported");break;case"umd":throw new Error("UMD not yet supported");break;case"commonjs":r="module.exports = "+s+";";break;default:r=s;break}r=o.headerString+"\n"+r;return r}function markAsReference(fnName){return REFERENCE_MARKER+fnName+REFERENCE_MARKER}function replaceActions(actionContainer,actionPropertyName){if(actionContainer[actionPropertyName]){var actions=Array.isArray(actionContainer[actionPropertyName])?actionContainer[actionPropertyName]:[actionContainer[actionPropertyName]];actionContainer[actionPropertyName]=actions.map(generateActionFunction).map(markAsReference);if(actionContainer[actionPropertyName].length===1){actionContainer[actionPropertyName]=actionContainer[actionPropertyName][0]}}}function visitState(state){if(state.datamodel){datamodelAccumulator.push.apply(datamodelAccumulator,state.datamodel)}if(state.onExit)replaceActions(state,"onExit");if(state.onEntry)replaceActions(state,"onEntry");if(state.transitions){state.transitions.forEach(function(transition){replaceActions(transition,"onTransition");if(transition.cond){transition.cond=markAsReference(generateAttributeExpression(transition,"cond"))}})}delete state.datamodel;if(state.states)state.states.forEach(function(substate){visitState(substate)})}function startTraversal(rootState,moduleType){moduleType=moduleType||"siaf";datamodelAccumulator=[];fnDecAccumulator=[];sendIdAccumulator=[];documentHasSendAction=false;documentHasSendActionWithIdlocationAttribute=false;visitState(rootState);return{module:generateModule(rootState,moduleType),name:rootState.name}}function safelyAddVariableToDatamodelAccumulator(variableName,lineNum,colNum){if(!datamodelAccumulator.some(function(data){return data.id===variableName})){datamodelAccumulator.push({$line:lineNum,$col:colNum,id:variableName})}}function getVariableNameForShallowCopy(){return"$scionArray_"+datamodelAccumulator.length+1}var actionTags={script:function(action){return action.content},assign:function(action){return action.location.expr+" = "+generateFnCall(generateAttributeExpression(action,"expr"))+";"},log:function(action){var params=[];if(action.label)params.push(JSON.stringify(action.label));if(action.expr){params.push(generateFnCall(generateAttributeExpression(action,"expr")))}return"this.log("+params.join(",")+");"},"if":function(action){var s="";var ifCondExprName=generateAttributeExpression(action,"cond");s+="if("+generateFnCall(ifCondExprName)+"){\n";var childNodes=action.actions;for(var i=0;i<childNodes.length;i++){var child=childNodes[i];if(child.$type==="elseif"||child.$type==="else"){break}else{s+="    "+generateFnCall(generateActionFunction(child))+";\n"}}for(;i<childNodes.length;i++){child=childNodes[i];if(child.$type==="elseif"){s+="}else if("+generateFnCall(generateAttributeExpression(child,"cond"))+"){\n"}else if(child.$type==="else"){s+="}";break}else{s+="    "+generateFnCall(generateActionFunction(child))+";\n"}}for(;i<childNodes.length;i++){child=childNodes[i];if(child.$type==="else"){s+="else{\n"}else{s+="    "+generateFnCall(generateActionFunction(child))+";\n"}}s+="}";return s},elseif:function(){throw new Error("Encountered unexpected elseif tag.")},"else":function(){throw new Error("Encountered unexpected else tag.")},raise:function(action){return"this.raise({ name:"+JSON.stringify(action.event)+", data : {}});"},cancel:function(action){return"this.cancel("+JSON.stringify(action.sendid)+");"},send:function(action){documentHasSendAction=true;function processAttr(container,attr){if(attr==="id"){sendIdAccumulator.push(container[attr])}var exprName=attr+"expr";if(attr==="idlocation"){documentHasSendActionWithIdlocationAttribute=true;var fakeExpr=JSON.parse(JSON.stringify(container));container[attr].expr=container[attr].expr+"="+generateFnCall(GENERATE_SENDID_FN_NAME);var fnName=generateAttributeExpression(container,attr);return generateFnCall(fnName)}else if(container[exprName]){var fnName=generateAttributeExpression(container,exprName);return generateFnCall(fnName)}else if(container[attr]){return JSON.stringify(container[attr])}else{return null}}function constructSendEventData(action){if(action.content){return"            "+JSON.stringify(action.content)}else if(action.contentexpr){return generateFnCall(generateAttributeExpression(action,"contentexpr"))}else{var s="{\n";var props=[];if(action.namelist){action.namelist.expr.trim().split(/ +/).forEach(function(name){props.push('"'+name+'"'+":"+name)})}if(action.params&&action.params.length){action.params.forEach(function(param){if(param.expr){props.push('"'+param.name+'"'+":"+generateFnCall(generateAttributeExpression(param,"expr")))}else if(param.location){props.push('"'+param.name+'"'+":"+generateFnCall(generateAttributeExpression(param,"location")))}})}s+=props.map(function(line){return"    "+line}).join(",\n");s+="\n}";s=s.split("\n").map(function(line){return"            "+line}).join("\n");return s}}var target=processAttr(action,"target"),targetVariableName="_scionTargetRef",targetDeclaration="var "+targetVariableName+" = "+target+";\n";var event=["{","   target: "+targetVariableName+",","   name: "+processAttr(action,"event")+",","   type: "+processAttr(action,"type")+",","   data: \n"+constructSendEventData(action)+",","   origin: _sessionid","}"].map(function(line){return"     "+line}).join("\n");var sendId;if(action.id){sendId=processAttr(action,"id")}else if(action.idlocation){sendId=processAttr(action,"idlocation")}else{sendId="null"}var send=targetDeclaration+"if("+targetVariableName+" === '#_internal'){\n"+"     this.raise(\n"+event+");\n"+"}else{\n"+"     this.send(\n"+event+", \n"+"       {\n"+"           delay: getDelayInMs("+processAttr(action,"delay")+"),\n"+"           sendid: "+sendId+"\n"+"       });\n"+"}";return send},foreach:function(action){var index=action.index||"$i",item=action.item,arr=action.array.expr,foreachFnNames=action.actions?action.actions.map(generateActionFunction):[];[action.item,action.index,action.array.expr].forEach(function(variableNameToDeclare){if(variableNameToDeclare){safelyAddVariableToDatamodelAccumulator(variableNameToDeclare,action.$line,action.$column)}});var shallowArrayName=getVariableNameForShallowCopy();var forEachContents=shallowArrayName+" = "+arr+";\n"+"if(Array.isArray("+shallowArrayName+")){\n"+"    for("+index+" = 0; "+index+" < "+shallowArrayName+".length;"+index+"++){\n"+"       "+item+" = "+shallowArrayName+"["+index+"];\n"+foreachFnNames.map(function(fnName){return"       "+generateFnCall(fnName)+";"}).join("\n")+"\n"+"    }\n"+"} else{\n"+"    for("+index+" in "+shallowArrayName+"){\n"+"        if("+shallowArrayName+".hasOwnProperty("+index+")){\n"+"           "+item+" = "+shallowArrayName+"["+index+"];\n"+foreachFnNames.map(function(fnName){return"           "+generateFnCall(fnName)+";"}).join("\n")+"\n"+"        }\n"+"    }\n"+"}";return forEachContents},custom:function(action){var customTagConfig={name:"Sandbox.action",data:action};return"postMessage("+JSON.stringify(customTagConfig,null,4)+");"}};function getDelayInMs(delayString){if(typeof delayString==="string"){if(delayString.slice(-2)==="ms"){return parseFloat(delayString.slice(0,-2))}else if(delayString.slice(-1)==="s"){return parseFloat(delayString.slice(0,-1))*1e3}else if(delayString.slice(-1)==="m"){return parseFloat(delayString.slice(0,-1))*1e3*60}else{return parseFloat(delayString)}}else if(typeof delayString==="number"){return delayString}else{return 0}}var GENERATE_SENDID_FN_NAME="$generateSendId";function generateIdlocationGenerator(){return["var $sendIdCounter = 0;","var $sendIdAccumulator = "+JSON.stringify(sendIdAccumulator)+";","function "+GENERATE_SENDID_FN_NAME+"(){ ","  var sendid;","  do{",'    sendid = "$scion.sendid" + $sendIdCounter++;',"  } while($sendIdAccumulator.indexOf(sendid) > -1)","  return sendid;","}"].join("\n")}module.exports=startTraversal;if(require.main===module){var usage="Usage: $0 --type [amd | umd | commondjs] [ FILE | - ]";var argv=require("optimist").usage(usage).argv;var moduleType=argv.type;var input=argv._[0];if(!input){console.error(usage);process.exit(1)}else if(input==="-"){process.stdin.setEncoding("utf8");process.stdin.resume();var jsonString="";process.stdin.on("data",function(s){jsonString+=s});process.stdin.on("end",go)}else{var fs=require("fs");jsonString=fs.readFileSync(input,"utf8");go()}}function go(){var o=startTraversal(JSON.parse(jsonString),moduleType);console.log(o.module)}}).call(this,require("_process"))},{_process:undefined,fs:undefined,optimist:undefined}],2:[function(require,module,exports){(function(process){var sax=require("sax"),strict=true,parser;function merge(o1,o2){Object.keys(o2).forEach(function(k){o1[k]=o2[k]});return o1}function getNormalizedAttributeName(attr){return attr.uri?"{"+attr.uri+"}"+attr.local:attr.local}function copyNsAttrObj(o){var r={};Object.keys(o).forEach(function(k){var attr=o[k];r[getNormalizedAttributeName(attr)]=attr.value});return r}function transform(xmlString){parser=sax.parser(strict,{trim:true,xmlns:true});var rootJson,currentJson,expressionAttributeCache,jsonStack=[],allTransitions=[];function createActionJson(node){var action=merge({$line:parser.line,$column:parser.column,$type:node.local},copyNsAttrObj(node.attributes));var actionContainer;if(Array.isArray(currentJson)){currentJson.push(action)}else if(currentJson.$type==="scxml"&&action.$type==="script"){currentJson.rootScripts=currentJson.rootScripts||[];currentJson.rootScripts.push(action)}else{currentJson.actions=currentJson.actions||[];currentJson.actions.push(action)}return currentJson=action}function createDataJson(node){currentJson=merge({$line:parser.line,$column:parser.column,$type:"data"},copyNsAttrObj(node.attributes));return currentJson}function createStateJson(node){var state=copyNsAttrObj(node.attributes);if(state.type){state.isDeep=state.type==="deep"?true:false}if(node.local!=="state"&&node.local!=="schema")state.$type=node.local;if(currentJson){if(!currentJson.states){currentJson.states=[]}currentJson.states.push(state)}return currentJson=state}function createTransitionJson(node){var transition=copyNsAttrObj(node.attributes);if(transition.target){transition.target=transition.target.trim().split(/\s+/);if(transition.target.length===1){transition.target=transition.target[0]}}if(currentJson){if(!currentJson.transitions){currentJson.transitions=[]}currentJson.transitions.push(transition)}allTransitions.push(transition);return currentJson=transition}function createExpression(value){return{$line:parser.line,$column:parser.column,expr:value}}var tagActions={scxml:function(node){return rootJson=createStateJson(node)},initial:createStateJson,history:createStateJson,state:createStateJson,parallel:createStateJson,"final":createStateJson,transition:createTransitionJson,onentry:function(node){currentJson=currentJson.onEntry=currentJson.onEntry||[]},onexit:function(node){currentJson=currentJson.onExit=currentJson.onExit||[]},foreach:createActionJson,raise:createActionJson,log:createActionJson,assign:createActionJson,validate:createActionJson,script:createActionJson,cancel:createActionJson,send:createActionJson,param:function(node){currentJson.params=currentJson.params||[];var attr=copyNsAttrObj(node.attributes);currentJson.params.push(attr);currentJson=attr},content:function(){if(expressionAttributeCache.expr){currentJson.contentexpr=merge({},expressionAttributeCache.expr)}},"if":createActionJson,elseif:createActionJson,"else":createActionJson,datamodel:function(node){currentJson=currentJson.datamodel=[]},data:function(node){currentJson.push(createDataJson(node))}};expressionAttributeCache={};parser.onopentag=function(node){if(tagActions[node.local]){tagActions[node.local](node);jsonStack.push(currentJson);merge(currentJson,expressionAttributeCache);expressionAttributeCache={}}else{createActionJson(node);jsonStack.push(currentJson);merge(currentJson,expressionAttributeCache);expressionAttributeCache={}}};var EXPRESSION_ATTRS=["cond","array","location","namelist","idlocation"];parser.onclosetag=function(tag){var localName=tag.split(":").pop();jsonStack.pop();currentJson=jsonStack[jsonStack.length-1]};parser.onattribute=function(attr){if(attr.name.match(/^.*expr$/)||EXPRESSION_ATTRS.indexOf(attr.name)>-1){expressionAttributeCache[getNormalizedAttributeName(attr)]=createExpression(attr.value)}};parser.onerror=function(e){throw e};parser.ontext=function(t){if(currentJson&&currentJson.$type){if(currentJson.$type==="script"){currentJson.content=t}else if(currentJson.$type==="send"){currentJson.content=t}else if(currentJson.$type==="data"){currentJson.content={$line:currentJson.$line,$column:currentJson.$column,expr:t}}else{currentJson.content=t}}};parser.oncdata=function(t){currentJson.content=t};parser.onend=function(){delete rootJson.xmlns;delete rootJson.version;if(typeof rootJson.datamodel==="string")delete rootJson.datamodel;allTransitions.forEach(function(transition){transition.onTransition=transition.actions;delete transition.actions})};parser.write(xmlString).close();return rootJson}module.exports=transform;if(require.main===module){console.log(JSON.stringify(transform(require("fs").readFileSync(process.argv[2],"utf8")),4,4))}}).call(this,require("_process"))},{_process:undefined,fs:undefined,sax:13}],3:[function(require,module,exports){var pm=require("../../runtime/platform-bootstrap/platform");var fileUtils={read:function(filePath,docUrl,context,cb){var result={error:null,content:""};if(docUrl){filePath=pm.platform.url.resolve(docUrl,filePath)}pm.platform.getResourceFromUrl(filePath,function(err,text,mimeType){if(err){result.error='Error downloading document "'+filePath+'", '+(err.message||err)}else{result.content=text}cb(result)},context)}};module.exports=fileUtils},{"../../runtime/platform-bootstrap/platform":11}],4:[function(require,module,exports){"use strict";var esprima=require("esprima");var fileUtils=require("./file-utils");var systemVariables=["_event","_sessionid","_name","_ioprocessors","_x"];var scJsonAnalyzer={analyze:function(scJson,docUrl,context,done){var changes=[],syntaxErrors=[],asyncCount=0,waitingForAsync=false,reportCompileErrors=context.reportAllErrors===true;function processState(state){if(state.datamodel)processActions(state,"datamodel");if(state.onExit)processActions(state,"onExit");if(state.onEntry)processActions(state,"onEntry");if(state.transitions){processActions(state,"transitions",state);state.transitions.forEach(function(transition,i){if(transition.onTransition){processActions(transition,"onTransition")}})}if(state.rootScripts){processActions(state,"rootScripts")}if(state.states)state.states.forEach(function(substate,i){processState(substate)})}function processActions(actionContainer,name,state){if(Array.isArray(actionContainer[name])){Object.keys(actionContainer[name]).forEach(function(i){checkAction(actionContainer[name],i,actionContainer[name][i].$type||name,state);if(actionContainer[name][i].actions)processActions(actionContainer[name][i],"actions")})}else{checkAction(actionContainer,name,name,state)}}function checkAction(action,propertyName,$type,state){if(actionTags[$type]){var errors=actionTags[$type](action[propertyName],function(errors,override){if(override){handleError(action,propertyName,errors,$type,state,override)}else if(errors.length>0){handleError(action,propertyName,errors,$type,state)}asyncDone()});if(errors){if(errors.override){handleError(action,propertyName,errors.errors,$type,state,errors.override)}else if(errors.length>0){handleError(action,propertyName,errors,$type,state)}}}}var actionTags={data:function(node,done){if(node.src&&node.src.indexOf("file:")===0){asyncStarted();getFileContents(node.src.substring(5),function(error,content){if(error){done([error])}else{delete node.src;node.expr={$column:node.$column,$line:node.$line,expr:normalizeWhitespace(content)};done(null,node)}})}else if(node.content){var errors=validateJavascriptAssignment(node.id,node.content);if(errors.length>0){node.content.expr=normalizeWhitespace(node.content.expr)}node.expr=node.content;delete node.content;return{override:node,errors:errors}}else{return validateJavascriptAssignment(node.id,node.expr)}},assign:function(node){if(node.location&&node.expr){return validateJavascriptAssignment(node.location,node.expr)}return[]},transitions:function(node){if(node.cond){var errors=validateJavascriptCondition(node.cond);if(errors.length){node.cond.expr="false";return{override:node,errors:errors}}}return[]},"if":function(node){return validateJavascriptCondition(node.cond)},ifelse:function(node){return validateJavascriptCondition(node.cond)},script:function(node,done){if(node.src){asyncStarted();getFileContents(node.src,function(error,content){if(error){done([error])}else{var errors=validateArbitraryJavascript(content);if(errors.length>0){done(errors)}else{delete node.src;node.content=content;done(null,node)}}})}if(node.content){return validateArbitraryJavascript(node.content)}},log:function(node){if(node.expr){return validateJavascriptExpression(node.expr)}return[]},send:function(node){if(node.$type){return validateJavascriptExpression(node.expr)}return[]},foreach:function(node){var errors=[];if(node.item){var results=validateJavascriptIdentifier(node.item);if(results&&results.length>0){errors=errors.concat(results)}}if(node.index){var results=validateJavascriptIdentifier(node.index);if(results&&results.length>0){errors=errors.concat(results)}}if(node.array){var results=validateJavascriptExpression(node.array);if(results&&results.length>0){errors=errors.concat(results)}}return errors}};function validateJavascriptAssignment(leftHand,rightHand){var errors=[];var leftHandCheck=validateArbitraryJavascript(leftHand);var rightHandCheck=validateArbitraryJavascript(extractJavascript(leftHand)+" = "+extractJavascript(rightHand));if(leftHandCheck.length){errors.push(leftHandCheck)}else if(rightHandCheck.length){errors.push(rightHandCheck)}else if(systemVariables.indexOf(extractJavascript(leftHand))!==-1){errors.push("You can't change system variables: "+leftHand)}return errors}function validateJavascriptCondition(condition){return validateArbitraryJavascript(condition)}function validateJavascriptExpression(js){return validateArbitraryJavascript(js)}function validateJavascriptIdentifier(js){js=extractJavascript(js);var errors=validateArbitraryJavascript(js);if(errors.length)return errors;var syntaxTree=esprima.parse(js,{});if(syntaxTree.body[0].expression.type!=="Identifier"){return["Illegal identifier: "+js]}}function validateArbitraryJavascript(js){js=extractJavascript(js);var errors=[];try{var syntaxTree=esprima.parse(js,{});traverseSyntaxTree(syntaxTree,errors)}catch(e){errors.push(e.message)}return errors}var treeTypes={AssignmentExpression:function(tree,errors){if(tree.init&&tree.init.left&&systemVariables.indexOf(tree.init.left.name)!==-1){errors.push("You can't change system variables: "+tree.init.left.name)}if(tree.expression&&tree.expression.left&&systemVariables.indexOf(tree.expression.left.name)!==-1){errors.push("You can't change system variables: "+tree.expression.left.name)}}};function traverseSyntaxTree(tree,errors){Object.keys(tree).forEach(function(i){if(tree[i]&&typeof tree[i]==="object"){if(tree[i].type&&treeTypes[tree[i].type]){treeTypes[tree[i].type](tree,errors)}traverseSyntaxTree(tree[i],errors)}})}function getFileContents(filePath,done){fileUtils.read(filePath,docUrl,context,function(fileContent){done(fileContent.error,fileContent.content)})}function handleError(node,property,errors,$type,state,override){if(reportCompileErrors&&errors&&errors.length){var n=node[property];syntaxErrors.push({tagname:n.$type,line:n.$line,column:n.$column,reason:errors.join("; ")})}var errorNode={$line:node[property].$line,$column:node[property].$column,$type:"raise",event:"error.execution",data:{message:errors?errors.join(", "):""}};changes.push({old:node,prop:property,$type:$type,"new":override,state:state,error:errorNode})}function extractJavascript(attribute){if(typeof attribute==="object"){attribute=attribute.expr}return attribute}function normalizeWhitespace(str){return JSON.stringify(str.replace(/^\s+|\s+$|\s+(?=\s)/g,"").replace(/\s/g," "))}function commitChanges(scJson,errors){changes.forEach(function(change){if(change.$type==="data"&&!change.new){delete scJson.datamodel;scJson.onEntry=[change.new||change.error]}else if(change.$type==="script"&&!change.new&&scJson.rootScripts){delete scJson.rootScripts;scJson.onEntry=[change.error]}else if(change.$type==="transitions"){if(!change.state.onEntry)change.state.onEntry=[];change.state.onEntry.push(change.error);change.old[change.prop]=change.new}else{change.old[change.prop]=change.new||change.error}})}function asyncStarted(){asyncCount++}function asyncDone(){asyncCount--;if(waitingForAsync&&asyncCount===0){completeAnalysis()}}function completeAnalysis(){if(syntaxErrors.length){scJson=undefined}else{commitChanges(scJson)}done({scJson:scJson,errors:syntaxErrors})}processState(scJson,"scJson");if(asyncCount===0){completeAnalysis()}else{waitingForAsync=true}}};module.exports=scJsonAnalyzer},{"./file-utils":3,esprima:12}],5:[function(require,module,exports){"use strict";var scxmlToScjson=require("../compiler/scxml-to-scjson"),scjsonToModule=require("../compiler/scjson-to-module"),scJsonAnalyzer=require("../compiler/static-analysis/scjson-analyzer"),pm=require("./platform-bootstrap/platform");function documentStringToModel(url,docString,cb,context){if(typeof context!=="object"||context===null){context={}}var scJson=scxmlToScjson(docString);scJsonAnalyzer.analyze(scJson,url,context,function(result){if(result.errors.length){cb(result.errors);return}createModule(url,result.scJson,context,cb)})}function createModule(url,scJson,context,cb){if(pm.platform.debug)console.log("scjson",JSON.stringify(scJson,4,4));var jsModule=scjsonToModule(scJson);if(pm.platform.debug){console.log("jsModuleString\n",jsModule)}var model=pm.platform.module.eval(jsModule.module,url,context);model.meta={name:jsModule.name};if(pm.platform.debug)console.log("model",model);cb(null,model)}module.exports=documentStringToModel},{"../compiler/scjson-to-module":1,"../compiler/scxml-to-scjson":2,"../compiler/static-analysis/scjson-analyzer":4,"./platform-bootstrap/platform":11}],6:[function(require,module,exports){"use strict";var pm=require("./platform-bootstrap/platform"),documentStringToModel=require("./document-string-to-model");function urlToModel(url,cb,context){if(!pm.platform.http.get)throw new Error("Platform does not support http.get");pm.platform.http.get(url,function(err,doc){if(err){cb(err,null)}else{documentStringToModel(url,doc,cb,context)}},context)}function pathToModel(url,cb,context){if(!pm.platform.fs.get)throw new Error("Platform does not support fs.get");context=context||{};context.isLoadedFromFile=true;pm.platform.fs.get(url,function(err,doc){if(err){cb(err,null)}else{documentStringToModel(url,doc,cb,context)}},context)}function documentToModel(doc,cb,context){var s=pm.platform.dom.serializeToString(doc);documentStringToModel(null,s,cb,context)}module.exports={pathToModel:pathToModel,urlToModel:urlToModel,documentStringToModel:documentStringToModel,documentToModel:documentToModel,ext:{platformModule:pm}}},{"./document-string-to-model":5,"./platform-bootstrap/platform":11}],7:[function(require,module,exports){var pm=require("../platform"),platform=require("./platform"),facade=require("../../facade"),scion=require("scion-core");pm.platform=platform;facade.scion=scion;module.exports=facade},{"../../facade":6,"../platform":11,"./platform":9,"scion-core":14}],8:[function(require,module,exports){"use strict";module.exports={sep:"/",join:function(path1,path2){return path1+"/"+path2},dirname:function(path){return path.split(this.sep).slice(0,-1).join(this.sep)},basename:function(path,ext){var name=path.split(this.sep).slice(-1);if(ext){var names=this.extname(name);if(names[1]===ext){name=names[1]}}return name},extname:function(path){return path.split(/\\.(?=[^\\.]+$)/)[1]}}},{}],9:[function(require,module,exports){"use strict";var url=require("./url"),path=require("./path");var platform=module.exports={ajax:window.jQuery,http:{get:function(url,cb,context){platform.ajax.get(url,function(r){cb(null,r)},"text").error(function(e){cb(e)})}},fs:{get:function(url,cb,context){platform.http.get.apply(platform,arguments)}},module:{eval:function(s,fileName,context){return eval(s)}},getResourceFromUrl:function(url,cb,context){platform.http.get.apply(platform,arguments)},url:{resolve:function(baseUrl,targetUrl){var documentUrlPath=url.getPathFromUrl(baseUrl);var documentDir=path.dirname(documentUrlPath);var scriptPath=path.join(documentDir,targetUrl);var newUrl=url.changeUrlPath(baseUrl,scriptPath);return newUrl}},dom:{serializeToString:function(node){return node.xml||(new window.XMLSerializer).serializeToString(node)}},log:function(){window.console.log.apply(window.console,arguments)}}},{"./path":8,"./url":10}],10:[function(require,module,exports){"use strict";function createAnchor(url){var a=document.createElement("a");a.href=url;return a}module.exports={getPathFromUrl:function(url){var a=createAnchor(url);return a.pathname},changeUrlPath:function(url,newPath){var a=createAnchor(url);return a.protocol+"//"+a.hostname+":"+a.port+newPath}}},{}],11:[function(require,module,exports){module.exports={}},{}],12:[function(require,module,exports){(function(root,factory){"use strict";if(typeof define==="function"&&define.amd){define(["exports"],factory)}else if(typeof exports!=="undefined"){factory(exports)}else{factory(root.esprima={})}})(this,function(exports){"use strict";var Token,TokenName,FnExprTokens,Syntax,PropertyKind,Messages,Regex,SyntaxTreeDelegate,source,strict,index,lineNumber,lineStart,length,delegate,lookahead,state,extra;Token={BooleanLiteral:1,
EOF:2,Identifier:3,Keyword:4,NullLiteral:5,NumericLiteral:6,Punctuator:7,StringLiteral:8,RegularExpression:9};TokenName={};TokenName[Token.BooleanLiteral]="Boolean";TokenName[Token.EOF]="<end>";TokenName[Token.Identifier]="Identifier";TokenName[Token.Keyword]="Keyword";TokenName[Token.NullLiteral]="Null";TokenName[Token.NumericLiteral]="Numeric";TokenName[Token.Punctuator]="Punctuator";TokenName[Token.StringLiteral]="String";TokenName[Token.RegularExpression]="RegularExpression";FnExprTokens=["(","{","[","in","typeof","instanceof","new","return","case","delete","throw","void","=","+=","-=","*=","/=","%=","<<=",">>=",">>>=","&=","|=","^=",",","+","-","*","/","%","++","--","<<",">>",">>>","&","|","^","!","~","&&","||","?",":","===","==",">=","<=","<",">","!=","!=="];Syntax={AssignmentExpression:"AssignmentExpression",ArrayExpression:"ArrayExpression",BlockStatement:"BlockStatement",BinaryExpression:"BinaryExpression",BreakStatement:"BreakStatement",CallExpression:"CallExpression",CatchClause:"CatchClause",ConditionalExpression:"ConditionalExpression",ContinueStatement:"ContinueStatement",DoWhileStatement:"DoWhileStatement",DebuggerStatement:"DebuggerStatement",EmptyStatement:"EmptyStatement",ExpressionStatement:"ExpressionStatement",ForStatement:"ForStatement",ForInStatement:"ForInStatement",FunctionDeclaration:"FunctionDeclaration",FunctionExpression:"FunctionExpression",Identifier:"Identifier",IfStatement:"IfStatement",Literal:"Literal",LabeledStatement:"LabeledStatement",LogicalExpression:"LogicalExpression",MemberExpression:"MemberExpression",NewExpression:"NewExpression",ObjectExpression:"ObjectExpression",Program:"Program",Property:"Property",ReturnStatement:"ReturnStatement",SequenceExpression:"SequenceExpression",SwitchStatement:"SwitchStatement",SwitchCase:"SwitchCase",ThisExpression:"ThisExpression",ThrowStatement:"ThrowStatement",TryStatement:"TryStatement",UnaryExpression:"UnaryExpression",UpdateExpression:"UpdateExpression",VariableDeclaration:"VariableDeclaration",VariableDeclarator:"VariableDeclarator",WhileStatement:"WhileStatement",WithStatement:"WithStatement"};PropertyKind={Data:1,Get:2,Set:4};Messages={UnexpectedToken:"Unexpected token %0",UnexpectedNumber:"Unexpected number",UnexpectedString:"Unexpected string",UnexpectedIdentifier:"Unexpected identifier",UnexpectedReserved:"Unexpected reserved word",UnexpectedEOS:"Unexpected end of input",NewlineAfterThrow:"Illegal newline after throw",InvalidRegExp:"Invalid regular expression",UnterminatedRegExp:"Invalid regular expression: missing /",InvalidLHSInAssignment:"Invalid left-hand side in assignment",InvalidLHSInForIn:"Invalid left-hand side in for-in",MultipleDefaultsInSwitch:"More than one default clause in switch statement",NoCatchOrFinally:"Missing catch or finally after try",UnknownLabel:"Undefined label '%0'",Redeclaration:"%0 '%1' has already been declared",IllegalContinue:"Illegal continue statement",IllegalBreak:"Illegal break statement",IllegalReturn:"Illegal return statement",StrictModeWith:"Strict mode code may not include a with statement",StrictCatchVariable:"Catch variable may not be eval or arguments in strict mode",StrictVarName:"Variable name may not be eval or arguments in strict mode",StrictParamName:"Parameter name eval or arguments is not allowed in strict mode",StrictParamDupe:"Strict mode function may not have duplicate parameter names",StrictFunctionName:"Function name may not be eval or arguments in strict mode",StrictOctalLiteral:"Octal literals are not allowed in strict mode.",StrictDelete:"Delete of an unqualified identifier in strict mode.",StrictDuplicateProperty:"Duplicate data property in object literal not allowed in strict mode",AccessorDataProperty:"Object literal may not have data and accessor property with the same name",AccessorGetSet:"Object literal may not have multiple get/set accessors with the same name",StrictLHSAssignment:"Assignment to eval or arguments is not allowed in strict mode",StrictLHSPostfix:"Postfix increment/decrement may not have eval or arguments operand in strict mode",StrictLHSPrefix:"Prefix increment/decrement may not have eval or arguments operand in strict mode",StrictReservedWord:"Use of future reserved word in strict mode"};Regex={NonAsciiIdentifierStart:new RegExp("[ªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮͰ-ʹͶͷͺ-ͽΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁҊ-ԧԱ-Ֆՙա-ևא-תװ-ײؠ-يٮٯٱ-ۓەۥۦۮۯۺ-ۼۿܐܒ-ܯݍ-ޥޱߊ-ߪߴߵߺࠀ-ࠕࠚࠤࠨࡀ-ࡘࢠࢢ-ࢬऄ-हऽॐक़-ॡॱ-ॷॹ-ॿঅ-ঌএঐও-নপ-রলশ-হঽৎড়ঢ়য়-ৡৰৱਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઍએ-ઑઓ-નપ-રલળવ-હઽૐૠૡଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହଽଡ଼ଢ଼ୟ-ୡୱஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹௐఅ-ఌఎ-ఐఒ-నప-ళవ-హఽౘౙౠౡಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽೞೠೡೱೲഅ-ഌഎ-ഐഒ-ഺഽൎൠൡൺ-ൿඅ-ඖක-නඳ-රලව-ෆก-ะาำเ-ๆກຂຄງຈຊຍດ-ທນ-ຟມ-ຣລວສຫອ-ະາຳຽເ-ໄໆໜ-ໟༀཀ-ཇཉ-ཬྈ-ྌက-ဪဿၐ-ၕၚ-ၝၡၥၦၮ-ၰၵ-ႁႎႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚᎀ-ᎏᎠ-Ᏼᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᛮ-ᛰᜀ-ᜌᜎ-ᜑᜠ-ᜱᝀ-ᝑᝠ-ᝬᝮ-ᝰក-ឳៗៜᠠ-ᡷᢀ-ᢨᢪᢰ-ᣵᤀ-ᤜᥐ-ᥭᥰ-ᥴᦀ-ᦫᧁ-ᧇᨀ-ᨖᨠ-ᩔᪧᬅ-ᬳᭅ-ᭋᮃ-ᮠᮮᮯᮺ-ᯥᰀ-ᰣᱍ-ᱏᱚ-ᱽᳩ-ᳬᳮ-ᳱᳵᳶᴀ-ᶿḀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼⁱⁿₐ-ₜℂℇℊ-ℓℕℙ-ℝℤΩℨK-ℭℯ-ℹℼ-ℿⅅ-ⅉⅎⅠ-ↈⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳮⳲⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞⸯ々-〇〡-〩〱-〵〸-〼ぁ-ゖゝ-ゟァ-ヺー-ヿㄅ-ㄭㄱ-ㆎㆠ-ㆺㇰ-ㇿ㐀-䶵一-鿌ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘟꘪꘫꙀ-ꙮꙿ-ꚗꚠ-ꛯꜗ-ꜟꜢ-ꞈꞋ-ꞎꞐ-ꞓꞠ-Ɦꟸ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠢꡀ-ꡳꢂ-ꢳꣲ-ꣷꣻꤊ-ꤥꤰ-ꥆꥠ-ꥼꦄ-ꦲꧏꨀ-ꨨꩀ-ꩂꩄ-ꩋꩠ-ꩶꩺꪀ-ꪯꪱꪵꪶꪹ-ꪽꫀꫂꫛ-ꫝꫠ-ꫪꫲ-ꫴꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꯀ-ꯢ가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִײַ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼＡ-Ｚａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ]"),NonAsciiIdentifierPart:new RegExp("[ªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮ̀-ʹͶͷͺ-ͽΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁ҃-҇Ҋ-ԧԱ-Ֆՙա-և֑-ׇֽֿׁׂׅׄא-תװ-ײؐ-ؚؠ-٩ٮ-ۓە-ۜ۟-۪ۨ-ۼۿܐ-݊ݍ-ޱ߀-ߵߺࠀ-࠭ࡀ-࡛ࢠࢢ-ࢬࣤ-ࣾऀ-ॣ०-९ॱ-ॷॹ-ॿঁ-ঃঅ-ঌএঐও-নপ-রলশ-হ়-ৄেৈো-ৎৗড়ঢ়য়-ৣ০-ৱਁ-ਃਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹ਼ਾ-ੂੇੈੋ-੍ੑਖ਼-ੜਫ਼੦-ੵઁ-ઃઅ-ઍએ-ઑઓ-નપ-રલળવ-હ઼-ૅે-ૉો-્ૐૠ-ૣ૦-૯ଁ-ଃଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହ଼-ୄେୈୋ-୍ୖୗଡ଼ଢ଼ୟ-ୣ୦-୯ୱஂஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹா-ூெ-ைொ-்ௐௗ௦-௯ఁ-ఃఅ-ఌఎ-ఐఒ-నప-ళవ-హఽ-ౄె-ైొ-్ౕౖౘౙౠ-ౣ౦-౯ಂಃಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹ಼-ೄೆ-ೈೊ-್ೕೖೞೠ-ೣ೦-೯ೱೲംഃഅ-ഌഎ-ഐഒ-ഺഽ-ൄെ-ൈൊ-ൎൗൠ-ൣ൦-൯ൺ-ൿංඃඅ-ඖක-නඳ-රලව-ෆ්ා-ුූෘ-ෟෲෳก-ฺเ-๎๐-๙ກຂຄງຈຊຍດ-ທນ-ຟມ-ຣລວສຫອ-ູົ-ຽເ-ໄໆ່-ໍ໐-໙ໜ-ໟༀ༘༙༠-༩༹༵༷༾-ཇཉ-ཬཱ-྄྆-ྗྙ-ྼ࿆က-၉ၐ-ႝႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚ፝-፟ᎀ-ᎏᎠ-Ᏼᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᛮ-ᛰᜀ-ᜌᜎ-᜔ᜠ-᜴ᝀ-ᝓᝠ-ᝬᝮ-ᝰᝲᝳក-៓ៗៜ៝០-៩᠋-᠍᠐-᠙ᠠ-ᡷᢀ-ᢪᢰ-ᣵᤀ-ᤜᤠ-ᤫᤰ-᤻᥆-ᥭᥰ-ᥴᦀ-ᦫᦰ-ᧉ᧐-᧙ᨀ-ᨛᨠ-ᩞ᩠-᩿᩼-᪉᪐-᪙ᪧᬀ-ᭋ᭐-᭙᭫-᭳ᮀ-᯳ᰀ-᰷᱀-᱉ᱍ-ᱽ᳐-᳔᳒-ᳶᴀ-ᷦ᷼-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼ‌‍‿⁀⁔ⁱⁿₐ-ₜ⃐-⃥⃜⃡-⃰ℂℇℊ-ℓℕℙ-ℝℤΩℨK-ℭℯ-ℹℼ-ℿⅅ-ⅉⅎⅠ-ↈⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯ⵿-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞⷠ-ⷿⸯ々-〇〡-〯〱-〵〸-〼ぁ-ゖ゙゚ゝ-ゟァ-ヺー-ヿㄅ-ㄭㄱ-ㆎㆠ-ㆺㇰ-ㇿ㐀-䶵一-鿌ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘫꙀ-꙯ꙴ-꙽ꙿ-ꚗꚟ-꛱ꜗ-ꜟꜢ-ꞈꞋ-ꞎꞐ-ꞓꞠ-Ɦꟸ-ꠧꡀ-ꡳꢀ-꣄꣐-꣙꣠-ꣷꣻ꤀-꤭ꤰ-꥓ꥠ-ꥼꦀ-꧀ꧏ-꧙ꨀ-ꨶꩀ-ꩍ꩐-꩙ꩠ-ꩶꩺꩻꪀ-ꫂꫛ-ꫝꫠ-ꫯꫲ-꫶ꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꯀ-ꯪ꯬꯭꯰-꯹가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻ︀-️︠-︦︳︴﹍-﹏ﹰ-ﹴﹶ-ﻼ０-９Ａ-Ｚ＿ａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ]")};function assert(condition,message){if(!condition){throw new Error("ASSERT: "+message)}}function isDecimalDigit(ch){return ch>=48&&ch<=57}function isHexDigit(ch){return"0123456789abcdefABCDEF".indexOf(ch)>=0}function isOctalDigit(ch){return"01234567".indexOf(ch)>=0}function isWhiteSpace(ch){return ch===32||ch===9||ch===11||ch===12||ch===160||ch>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(ch)>=0}function isLineTerminator(ch){return ch===10||ch===13||ch===8232||ch===8233}function isIdentifierStart(ch){return ch===36||ch===95||ch>=65&&ch<=90||ch>=97&&ch<=122||ch===92||ch>=128&&Regex.NonAsciiIdentifierStart.test(String.fromCharCode(ch))}function isIdentifierPart(ch){return ch===36||ch===95||ch>=65&&ch<=90||ch>=97&&ch<=122||ch>=48&&ch<=57||ch===92||ch>=128&&Regex.NonAsciiIdentifierPart.test(String.fromCharCode(ch))}function isFutureReservedWord(id){switch(id){case"class":case"enum":case"export":case"extends":case"import":case"super":return true;default:return false}}function isStrictModeReservedWord(id){switch(id){case"implements":case"interface":case"package":case"private":case"protected":case"public":case"static":case"yield":case"let":return true;default:return false}}function isRestrictedWord(id){return id==="eval"||id==="arguments"}function isKeyword(id){if(strict&&isStrictModeReservedWord(id)){return true}switch(id.length){case 2:return id==="if"||id==="in"||id==="do";case 3:return id==="var"||id==="for"||id==="new"||id==="try"||id==="let";case 4:return id==="this"||id==="else"||id==="case"||id==="void"||id==="with"||id==="enum";case 5:return id==="while"||id==="break"||id==="catch"||id==="throw"||id==="const"||id==="yield"||id==="class"||id==="super";case 6:return id==="return"||id==="typeof"||id==="delete"||id==="switch"||id==="export"||id==="import";case 7:return id==="default"||id==="finally"||id==="extends";case 8:return id==="function"||id==="continue"||id==="debugger";case 10:return id==="instanceof";default:return false}}function addComment(type,value,start,end,loc){var comment,attacher;assert(typeof start==="number","Comment must have valid position");if(state.lastCommentStart>=start){return}state.lastCommentStart=start;comment={type:type,value:value};if(extra.range){comment.range=[start,end]}if(extra.loc){comment.loc=loc}extra.comments.push(comment);if(extra.attachComment){extra.leadingComments.push(comment);extra.trailingComments.push(comment)}}function skipSingleLineComment(offset){var start,loc,ch,comment;start=index-offset;loc={start:{line:lineNumber,column:index-lineStart-offset}};while(index<length){ch=source.charCodeAt(index);++index;if(isLineTerminator(ch)){if(extra.comments){comment=source.slice(start+offset,index-1);loc.end={line:lineNumber,column:index-lineStart-1};addComment("Line",comment,start,index-1,loc)}if(ch===13&&source.charCodeAt(index)===10){++index}++lineNumber;lineStart=index;return}}if(extra.comments){comment=source.slice(start+offset,index);loc.end={line:lineNumber,column:index-lineStart};addComment("Line",comment,start,index,loc)}}function skipMultiLineComment(){var start,loc,ch,comment;if(extra.comments){start=index-2;loc={start:{line:lineNumber,column:index-lineStart-2}}}while(index<length){ch=source.charCodeAt(index);if(isLineTerminator(ch)){if(ch===13&&source.charCodeAt(index+1)===10){++index}++lineNumber;++index;lineStart=index;if(index>=length){throwError({},Messages.UnexpectedToken,"ILLEGAL")}}else if(ch===42){if(source.charCodeAt(index+1)===47){++index;++index;if(extra.comments){comment=source.slice(start+2,index-2);loc.end={line:lineNumber,column:index-lineStart};addComment("Block",comment,start,index,loc)}return}++index}else{++index}}throwError({},Messages.UnexpectedToken,"ILLEGAL")}function skipComment(){var ch,start;start=index===0;while(index<length){ch=source.charCodeAt(index);if(isWhiteSpace(ch)){++index}else if(isLineTerminator(ch)){++index;if(ch===13&&source.charCodeAt(index)===10){++index}++lineNumber;lineStart=index;start=true}else if(ch===47){ch=source.charCodeAt(index+1);if(ch===47){++index;++index;skipSingleLineComment(2);start=true}else if(ch===42){++index;++index;skipMultiLineComment()}else{break}}else if(start&&ch===45){if(source.charCodeAt(index+1)===45&&source.charCodeAt(index+2)===62){index+=3;skipSingleLineComment(3)}else{break}}else if(ch===60){if(source.slice(index+1,index+4)==="!--"){++index;++index;++index;++index;skipSingleLineComment(4)}else{break}}else{break}}}function scanHexEscape(prefix){var i,len,ch,code=0;len=prefix==="u"?4:2;for(i=0;i<len;++i){if(index<length&&isHexDigit(source[index])){ch=source[index++];code=code*16+"0123456789abcdef".indexOf(ch.toLowerCase())}else{return""}}return String.fromCharCode(code)}function getEscapedIdentifier(){var ch,id;ch=source.charCodeAt(index++);id=String.fromCharCode(ch);if(ch===92){if(source.charCodeAt(index)!==117){throwError({},Messages.UnexpectedToken,"ILLEGAL")}++index;ch=scanHexEscape("u");if(!ch||ch==="\\"||!isIdentifierStart(ch.charCodeAt(0))){throwError({},Messages.UnexpectedToken,"ILLEGAL")}id=ch}while(index<length){ch=source.charCodeAt(index);if(!isIdentifierPart(ch)){break}++index;id+=String.fromCharCode(ch);if(ch===92){id=id.substr(0,id.length-1);if(source.charCodeAt(index)!==117){throwError({},Messages.UnexpectedToken,"ILLEGAL")}++index;ch=scanHexEscape("u");if(!ch||ch==="\\"||!isIdentifierPart(ch.charCodeAt(0))){throwError({},Messages.UnexpectedToken,"ILLEGAL")}id+=ch}}return id}function getIdentifier(){var start,ch;start=index++;while(index<length){ch=source.charCodeAt(index);if(ch===92){index=start;return getEscapedIdentifier()}if(isIdentifierPart(ch)){++index}else{break}}return source.slice(start,index)}function scanIdentifier(){var start,id,type;start=index;id=source.charCodeAt(index)===92?getEscapedIdentifier():getIdentifier();if(id.length===1){type=Token.Identifier}else if(isKeyword(id)){type=Token.Keyword}else if(id==="null"){type=Token.NullLiteral}else if(id==="true"||id==="false"){type=Token.BooleanLiteral}else{type=Token.Identifier}return{type:type,value:id,lineNumber:lineNumber,lineStart:lineStart,start:start,end:index}}function scanPunctuator(){var start=index,code=source.charCodeAt(index),code2,ch1=source[index],ch2,ch3,ch4;switch(code){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:++index;if(extra.tokenize){if(code===40){extra.openParenToken=extra.tokens.length}else if(code===123){extra.openCurlyToken=extra.tokens.length}}return{type:Token.Punctuator,value:String.fromCharCode(code),lineNumber:lineNumber,lineStart:lineStart,start:start,end:index};default:code2=source.charCodeAt(index+1);if(code2===61){switch(code){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:index+=2;return{type:Token.Punctuator,value:String.fromCharCode(code)+String.fromCharCode(code2),lineNumber:lineNumber,lineStart:lineStart,start:start,end:index};case 33:case 61:index+=2;if(source.charCodeAt(index)===61){++index}return{type:Token.Punctuator,value:source.slice(start,index),lineNumber:lineNumber,lineStart:lineStart,start:start,end:index}}}}ch4=source.substr(index,4);if(ch4===">>>="){index+=4;return{type:Token.Punctuator,value:ch4,lineNumber:lineNumber,lineStart:lineStart,start:start,end:index}}ch3=ch4.substr(0,3);if(ch3===">>>"||ch3==="<<="||ch3===">>="){index+=3;return{type:Token.Punctuator,value:ch3,lineNumber:lineNumber,lineStart:lineStart,start:start,end:index}}ch2=ch3.substr(0,2);if(ch1===ch2[1]&&"+-<>&|".indexOf(ch1)>=0||ch2==="=>"){index+=2;return{type:Token.Punctuator,value:ch2,lineNumber:lineNumber,lineStart:lineStart,start:start,end:index}}if("<>=!+-*%&|^/".indexOf(ch1)>=0){++index;return{type:Token.Punctuator,value:ch1,lineNumber:lineNumber,lineStart:lineStart,start:start,end:index}}throwError({},Messages.UnexpectedToken,"ILLEGAL")}function scanHexLiteral(start){var number="";while(index<length){if(!isHexDigit(source[index])){break}number+=source[index++]}if(number.length===0){throwError({},Messages.UnexpectedToken,"ILLEGAL")}if(isIdentifierStart(source.charCodeAt(index))){throwError({},Messages.UnexpectedToken,"ILLEGAL")}return{type:Token.NumericLiteral,value:parseInt("0x"+number,16),lineNumber:lineNumber,lineStart:lineStart,start:start,end:index}}function scanOctalLiteral(start){var number="0"+source[index++];while(index<length){if(!isOctalDigit(source[index])){break}number+=source[index++]}if(isIdentifierStart(source.charCodeAt(index))||isDecimalDigit(source.charCodeAt(index))){throwError({},Messages.UnexpectedToken,"ILLEGAL")}return{type:Token.NumericLiteral,value:parseInt(number,8),octal:true,lineNumber:lineNumber,lineStart:lineStart,start:start,end:index}}function scanNumericLiteral(){var number,start,ch;ch=source[index];assert(isDecimalDigit(ch.charCodeAt(0))||ch===".","Numeric literal must start with a decimal digit or a decimal point");start=index;number="";if(ch!=="."){number=source[index++];ch=source[index];if(number==="0"){if(ch==="x"||ch==="X"){++index;return scanHexLiteral(start)}if(isOctalDigit(ch)){return scanOctalLiteral(start)}if(ch&&isDecimalDigit(ch.charCodeAt(0))){throwError({},Messages.UnexpectedToken,"ILLEGAL")}}while(isDecimalDigit(source.charCodeAt(index))){number+=source[index++]}ch=source[index]}if(ch==="."){number+=source[index++];while(isDecimalDigit(source.charCodeAt(index))){number+=source[index++]}ch=source[index]}if(ch==="e"||ch==="E"){number+=source[index++];ch=source[index];if(ch==="+"||ch==="-"){number+=source[index++]}if(isDecimalDigit(source.charCodeAt(index))){while(isDecimalDigit(source.charCodeAt(index))){number+=source[index++]}}else{throwError({},Messages.UnexpectedToken,"ILLEGAL")}}if(isIdentifierStart(source.charCodeAt(index))){throwError({},Messages.UnexpectedToken,"ILLEGAL")}return{type:Token.NumericLiteral,value:parseFloat(number),lineNumber:lineNumber,lineStart:lineStart,start:start,end:index}}function scanStringLiteral(){var str="",quote,start,ch,code,unescaped,restore,octal=false,startLineNumber,startLineStart;startLineNumber=lineNumber;startLineStart=lineStart;quote=source[index];assert(quote==="'"||quote==='"',"String literal must starts with a quote");start=index;++index;while(index<length){ch=source[index++];if(ch===quote){quote="";break}else if(ch==="\\"){ch=source[index++];if(!ch||!isLineTerminator(ch.charCodeAt(0))){switch(ch){case"u":case"x":restore=index;unescaped=scanHexEscape(ch);if(unescaped){str+=unescaped}else{index=restore;str+=ch}break;case"n":str+="\n";break;case"r":str+="\r";break;case"t":str+="	";break;case"b":str+="\b";break;case"f":str+="\f";break;case"v":str+="";break;default:if(isOctalDigit(ch)){code="01234567".indexOf(ch);if(code!==0){octal=true}if(index<length&&isOctalDigit(source[index])){octal=true;code=code*8+"01234567".indexOf(source[index++]);if("0123".indexOf(ch)>=0&&index<length&&isOctalDigit(source[index])){code=code*8+"01234567".indexOf(source[index++])}}str+=String.fromCharCode(code)}else{str+=ch}break}}else{++lineNumber;if(ch==="\r"&&source[index]==="\n"){++index}lineStart=index}}else if(isLineTerminator(ch.charCodeAt(0))){break}else{str+=ch}}if(quote!==""){throwError({},Messages.UnexpectedToken,"ILLEGAL")}return{type:Token.StringLiteral,value:str,octal:octal,startLineNumber:startLineNumber,startLineStart:startLineStart,lineNumber:lineNumber,lineStart:lineStart,start:start,end:index}}function testRegExp(pattern,flags){var value;try{value=new RegExp(pattern,flags)}catch(e){throwError({},Messages.InvalidRegExp)}return value}function scanRegExpBody(){var ch,str,classMarker,terminated,body;ch=source[index];assert(ch==="/","Regular expression literal must start with a slash");str=source[index++];classMarker=false;terminated=false;while(index<length){ch=source[index++];str+=ch;if(ch==="\\"){ch=source[index++];if(isLineTerminator(ch.charCodeAt(0))){throwError({},Messages.UnterminatedRegExp)}str+=ch}else if(isLineTerminator(ch.charCodeAt(0))){throwError({},Messages.UnterminatedRegExp)}else if(classMarker){if(ch==="]"){classMarker=false}}else{if(ch==="/"){terminated=true;break}else if(ch==="["){classMarker=true}}}if(!terminated){throwError({},Messages.UnterminatedRegExp)}body=str.substr(1,str.length-2);return{value:body,literal:str}}function scanRegExpFlags(){var ch,str,flags,restore;str="";flags="";while(index<length){ch=source[index];if(!isIdentifierPart(ch.charCodeAt(0))){break}++index;if(ch==="\\"&&index<length){ch=source[index];if(ch==="u"){++index;restore=index;ch=scanHexEscape("u");if(ch){flags+=ch;for(str+="\\u";restore<index;++restore){str+=source[restore]}}else{index=restore;flags+="u";str+="\\u"}throwErrorTolerant({},Messages.UnexpectedToken,"ILLEGAL")}else{str+="\\";throwErrorTolerant({},Messages.UnexpectedToken,"ILLEGAL")}}else{flags+=ch;str+=ch}}return{value:flags,literal:str}}function scanRegExp(){var start,body,flags,pattern,value;lookahead=null;skipComment();start=index;body=scanRegExpBody();flags=scanRegExpFlags();value=testRegExp(body.value,flags.value);if(extra.tokenize){return{type:Token.RegularExpression,value:value,lineNumber:lineNumber,lineStart:lineStart,start:start,end:index}}return{literal:body.literal+flags.literal,value:value,start:start,end:index}}function collectRegex(){var pos,loc,regex,token;skipComment();pos=index;loc={start:{line:lineNumber,column:index-lineStart}};regex=scanRegExp();loc.end={line:lineNumber,column:index-lineStart};if(!extra.tokenize){if(extra.tokens.length>0){token=extra.tokens[extra.tokens.length-1];if(token.range[0]===pos&&token.type==="Punctuator"){if(token.value==="/"||token.value==="/="){extra.tokens.pop()}}}extra.tokens.push({type:"RegularExpression",value:regex.literal,range:[pos,index],loc:loc})}return regex}function isIdentifierName(token){return token.type===Token.Identifier||token.type===Token.Keyword||token.type===Token.BooleanLiteral||token.type===Token.NullLiteral}function advanceSlash(){var prevToken,checkToken;prevToken=extra.tokens[extra.tokens.length-1];if(!prevToken){return collectRegex()}if(prevToken.type==="Punctuator"){if(prevToken.value==="]"){return scanPunctuator()}if(prevToken.value===")"){checkToken=extra.tokens[extra.openParenToken-1];if(checkToken&&checkToken.type==="Keyword"&&(checkToken.value==="if"||checkToken.value==="while"||checkToken.value==="for"||checkToken.value==="with")){return collectRegex()}return scanPunctuator()}if(prevToken.value==="}"){if(extra.tokens[extra.openCurlyToken-3]&&extra.tokens[extra.openCurlyToken-3].type==="Keyword"){checkToken=extra.tokens[extra.openCurlyToken-4];if(!checkToken){return scanPunctuator()}}else if(extra.tokens[extra.openCurlyToken-4]&&extra.tokens[extra.openCurlyToken-4].type==="Keyword"){checkToken=extra.tokens[extra.openCurlyToken-5];if(!checkToken){return collectRegex()}}else{return scanPunctuator()}if(FnExprTokens.indexOf(checkToken.value)>=0){return scanPunctuator()}return collectRegex()}return collectRegex()}if(prevToken.type==="Keyword"&&prevToken.value!=="this"){return collectRegex()}return scanPunctuator()}function advance(){var ch;skipComment();if(index>=length){return{type:Token.EOF,lineNumber:lineNumber,lineStart:lineStart,start:index,end:index}}ch=source.charCodeAt(index);if(isIdentifierStart(ch)){return scanIdentifier()}if(ch===40||ch===41||ch===59){return scanPunctuator()}if(ch===39||ch===34){return scanStringLiteral()}if(ch===46){if(isDecimalDigit(source.charCodeAt(index+1))){return scanNumericLiteral()}return scanPunctuator()}if(isDecimalDigit(ch)){return scanNumericLiteral()}if(extra.tokenize&&ch===47){return advanceSlash()}return scanPunctuator()}function collectToken(){var loc,token,range,value;skipComment();loc={start:{line:lineNumber,column:index-lineStart}};token=advance();loc.end={line:lineNumber,column:index-lineStart};if(token.type!==Token.EOF){value=source.slice(token.start,token.end);extra.tokens.push({type:TokenName[token.type],value:value,range:[token.start,token.end],loc:loc})}return token}function lex(){var token;token=lookahead;index=token.end;lineNumber=token.lineNumber;lineStart=token.lineStart;lookahead=typeof extra.tokens!=="undefined"?collectToken():advance();index=token.end;lineNumber=token.lineNumber;lineStart=token.lineStart;return token}function peek(){var pos,line,start;pos=index;line=lineNumber;start=lineStart;lookahead=typeof extra.tokens!=="undefined"?collectToken():advance();index=pos;lineNumber=line;lineStart=start}function Position(line,column){this.line=line;this.column=column}function SourceLocation(startLine,startColumn,line,column){this.start=new Position(startLine,startColumn);this.end=new Position(line,column)}SyntaxTreeDelegate={name:"SyntaxTree",processComment:function(node){var lastChild,trailingComments;if(node.type===Syntax.Program){if(node.body.length>0){return}}if(extra.trailingComments.length>0){if(extra.trailingComments[0].range[0]>=node.range[1]){trailingComments=extra.trailingComments;extra.trailingComments=[]}else{extra.trailingComments.length=0}}else{if(extra.bottomRightStack.length>0&&extra.bottomRightStack[extra.bottomRightStack.length-1].trailingComments&&extra.bottomRightStack[extra.bottomRightStack.length-1].trailingComments[0].range[0]>=node.range[1]){trailingComments=extra.bottomRightStack[extra.bottomRightStack.length-1].trailingComments;delete extra.bottomRightStack[extra.bottomRightStack.length-1].trailingComments}}while(extra.bottomRightStack.length>0&&extra.bottomRightStack[extra.bottomRightStack.length-1].range[0]>=node.range[0]){lastChild=extra.bottomRightStack.pop()}if(lastChild){if(lastChild.leadingComments&&lastChild.leadingComments[lastChild.leadingComments.length-1].range[1]<=node.range[0]){node.leadingComments=lastChild.leadingComments;delete lastChild.leadingComments}}else if(extra.leadingComments.length>0&&extra.leadingComments[extra.leadingComments.length-1].range[1]<=node.range[0]){node.leadingComments=extra.leadingComments;extra.leadingComments=[]}if(trailingComments){node.trailingComments=trailingComments}extra.bottomRightStack.push(node)},markEnd:function(node,startToken){if(extra.range){node.range=[startToken.start,index]}if(extra.loc){node.loc=new SourceLocation(startToken.startLineNumber===undefined?startToken.lineNumber:startToken.startLineNumber,startToken.start-(startToken.startLineStart===undefined?startToken.lineStart:startToken.startLineStart),lineNumber,index-lineStart);this.postProcess(node)}if(extra.attachComment){this.processComment(node)}return node},postProcess:function(node){if(extra.source){node.loc.source=extra.source}return node},createArrayExpression:function(elements){return{type:Syntax.ArrayExpression,elements:elements}},createAssignmentExpression:function(operator,left,right){return{type:Syntax.AssignmentExpression,operator:operator,left:left,right:right}},createBinaryExpression:function(operator,left,right){var type=operator==="||"||operator==="&&"?Syntax.LogicalExpression:Syntax.BinaryExpression;return{type:type,operator:operator,left:left,right:right}},createBlockStatement:function(body){return{type:Syntax.BlockStatement,body:body}},createBreakStatement:function(label){return{type:Syntax.BreakStatement,label:label}},createCallExpression:function(callee,args){return{type:Syntax.CallExpression,callee:callee,arguments:args}},createCatchClause:function(param,body){return{type:Syntax.CatchClause,param:param,body:body}},createConditionalExpression:function(test,consequent,alternate){return{type:Syntax.ConditionalExpression,test:test,consequent:consequent,alternate:alternate}},createContinueStatement:function(label){return{type:Syntax.ContinueStatement,label:label}},createDebuggerStatement:function(){return{type:Syntax.DebuggerStatement}},createDoWhileStatement:function(body,test){return{type:Syntax.DoWhileStatement,body:body,test:test}},createEmptyStatement:function(){return{type:Syntax.EmptyStatement}},createExpressionStatement:function(expression){return{type:Syntax.ExpressionStatement,expression:expression}},createForStatement:function(init,test,update,body){return{type:Syntax.ForStatement,init:init,test:test,update:update,body:body}},createForInStatement:function(left,right,body){return{type:Syntax.ForInStatement,left:left,right:right,body:body,each:false}},createFunctionDeclaration:function(id,params,defaults,body){return{type:Syntax.FunctionDeclaration,id:id,params:params,defaults:defaults,body:body,rest:null,generator:false,expression:false}},createFunctionExpression:function(id,params,defaults,body){return{type:Syntax.FunctionExpression,id:id,params:params,defaults:defaults,body:body,rest:null,generator:false,expression:false}},createIdentifier:function(name){return{type:Syntax.Identifier,name:name}},createIfStatement:function(test,consequent,alternate){return{type:Syntax.IfStatement,test:test,consequent:consequent,alternate:alternate}},createLabeledStatement:function(label,body){return{type:Syntax.LabeledStatement,label:label,body:body}},createLiteral:function(token){return{type:Syntax.Literal,value:token.value,raw:source.slice(token.start,token.end)}},createMemberExpression:function(accessor,object,property){return{type:Syntax.MemberExpression,computed:accessor==="[",object:object,property:property}},createNewExpression:function(callee,args){return{type:Syntax.NewExpression,callee:callee,arguments:args}},createObjectExpression:function(properties){return{type:Syntax.ObjectExpression,properties:properties}},createPostfixExpression:function(operator,argument){return{type:Syntax.UpdateExpression,operator:operator,argument:argument,prefix:false}},createProgram:function(body){return{type:Syntax.Program,body:body}},createProperty:function(kind,key,value){return{type:Syntax.Property,key:key,value:value,kind:kind}},createReturnStatement:function(argument){return{type:Syntax.ReturnStatement,argument:argument}},createSequenceExpression:function(expressions){return{type:Syntax.SequenceExpression,expressions:expressions}},createSwitchCase:function(test,consequent){return{type:Syntax.SwitchCase,test:test,consequent:consequent}},createSwitchStatement:function(discriminant,cases){return{type:Syntax.SwitchStatement,discriminant:discriminant,cases:cases}},createThisExpression:function(){return{type:Syntax.ThisExpression}},createThrowStatement:function(argument){return{type:Syntax.ThrowStatement,argument:argument}},createTryStatement:function(block,guardedHandlers,handlers,finalizer){return{type:Syntax.TryStatement,block:block,guardedHandlers:guardedHandlers,handlers:handlers,finalizer:finalizer}},createUnaryExpression:function(operator,argument){if(operator==="++"||operator==="--"){return{type:Syntax.UpdateExpression,operator:operator,argument:argument,prefix:true}}return{type:Syntax.UnaryExpression,operator:operator,argument:argument,prefix:true}},createVariableDeclaration:function(declarations,kind){return{type:Syntax.VariableDeclaration,declarations:declarations,kind:kind}},createVariableDeclarator:function(id,init){return{type:Syntax.VariableDeclarator,id:id,init:init}},createWhileStatement:function(test,body){return{type:Syntax.WhileStatement,test:test,body:body}},createWithStatement:function(object,body){return{type:Syntax.WithStatement,object:object,body:body}}};function peekLineTerminator(){var pos,line,start,found;pos=index;line=lineNumber;start=lineStart;skipComment();found=lineNumber!==line;index=pos;lineNumber=line;lineStart=start;return found}function throwError(token,messageFormat){var error,args=Array.prototype.slice.call(arguments,2),msg=messageFormat.replace(/%(\d)/g,function(whole,index){assert(index<args.length,"Message reference must be in range");return args[index]});if(typeof token.lineNumber==="number"){error=new Error("Line "+token.lineNumber+": "+msg);error.index=token.start;error.lineNumber=token.lineNumber;error.column=token.start-lineStart+1}else{error=new Error("Line "+lineNumber+": "+msg);error.index=index;error.lineNumber=lineNumber;error.column=index-lineStart+1}error.description=msg;throw error}function throwErrorTolerant(){try{throwError.apply(null,arguments)}catch(e){if(extra.errors){extra.errors.push(e)}else{throw e}}}function throwUnexpected(token){if(token.type===Token.EOF){throwError(token,Messages.UnexpectedEOS)}if(token.type===Token.NumericLiteral){throwError(token,Messages.UnexpectedNumber)}if(token.type===Token.StringLiteral){throwError(token,Messages.UnexpectedString)}if(token.type===Token.Identifier){throwError(token,Messages.UnexpectedIdentifier)}if(token.type===Token.Keyword){if(isFutureReservedWord(token.value)){throwError(token,Messages.UnexpectedReserved)}else if(strict&&isStrictModeReservedWord(token.value)){throwErrorTolerant(token,Messages.StrictReservedWord);return}throwError(token,Messages.UnexpectedToken,token.value)}throwError(token,Messages.UnexpectedToken,token.value)}function expect(value){var token=lex();if(token.type!==Token.Punctuator||token.value!==value){throwUnexpected(token)}}function expectKeyword(keyword){var token=lex();if(token.type!==Token.Keyword||token.value!==keyword){throwUnexpected(token)}}function match(value){return lookahead.type===Token.Punctuator&&lookahead.value===value}function matchKeyword(keyword){return lookahead.type===Token.Keyword&&lookahead.value===keyword}function matchAssign(){var op;if(lookahead.type!==Token.Punctuator){return false}op=lookahead.value;return op==="="||op==="*="||op==="/="||op==="%="||op==="+="||op==="-="||op==="<<="||op===">>="||op===">>>="||op==="&="||op==="^="||op==="|="}function consumeSemicolon(){var line;if(source.charCodeAt(index)===59||match(";")){lex();return}line=lineNumber;skipComment();if(lineNumber!==line){return}if(lookahead.type!==Token.EOF&&!match("}")){throwUnexpected(lookahead)}}function isLeftHandSide(expr){return expr.type===Syntax.Identifier||expr.type===Syntax.MemberExpression;

}function parseArrayInitialiser(){var elements=[],startToken;startToken=lookahead;expect("[");while(!match("]")){if(match(",")){lex();elements.push(null)}else{elements.push(parseAssignmentExpression());if(!match("]")){expect(",")}}}lex();return delegate.markEnd(delegate.createArrayExpression(elements),startToken)}function parsePropertyFunction(param,first){var previousStrict,body,startToken;previousStrict=strict;startToken=lookahead;body=parseFunctionSourceElements();if(first&&strict&&isRestrictedWord(param[0].name)){throwErrorTolerant(first,Messages.StrictParamName)}strict=previousStrict;return delegate.markEnd(delegate.createFunctionExpression(null,param,[],body),startToken)}function parseObjectPropertyKey(){var token,startToken;startToken=lookahead;token=lex();if(token.type===Token.StringLiteral||token.type===Token.NumericLiteral){if(strict&&token.octal){throwErrorTolerant(token,Messages.StrictOctalLiteral)}return delegate.markEnd(delegate.createLiteral(token),startToken)}return delegate.markEnd(delegate.createIdentifier(token.value),startToken)}function parseObjectProperty(){var token,key,id,value,param,startToken;token=lookahead;startToken=lookahead;if(token.type===Token.Identifier){id=parseObjectPropertyKey();if(token.value==="get"&&!match(":")){key=parseObjectPropertyKey();expect("(");expect(")");value=parsePropertyFunction([]);return delegate.markEnd(delegate.createProperty("get",key,value),startToken)}if(token.value==="set"&&!match(":")){key=parseObjectPropertyKey();expect("(");token=lookahead;if(token.type!==Token.Identifier){expect(")");throwErrorTolerant(token,Messages.UnexpectedToken,token.value);value=parsePropertyFunction([])}else{param=[parseVariableIdentifier()];expect(")");value=parsePropertyFunction(param,token)}return delegate.markEnd(delegate.createProperty("set",key,value),startToken)}expect(":");value=parseAssignmentExpression();return delegate.markEnd(delegate.createProperty("init",id,value),startToken)}if(token.type===Token.EOF||token.type===Token.Punctuator){throwUnexpected(token)}else{key=parseObjectPropertyKey();expect(":");value=parseAssignmentExpression();return delegate.markEnd(delegate.createProperty("init",key,value),startToken)}}function parseObjectInitialiser(){var properties=[],property,name,key,kind,map={},toString=String,startToken;startToken=lookahead;expect("{");while(!match("}")){property=parseObjectProperty();if(property.key.type===Syntax.Identifier){name=property.key.name}else{name=toString(property.key.value)}kind=property.kind==="init"?PropertyKind.Data:property.kind==="get"?PropertyKind.Get:PropertyKind.Set;key="$"+name;if(Object.prototype.hasOwnProperty.call(map,key)){if(map[key]===PropertyKind.Data){if(strict&&kind===PropertyKind.Data){throwErrorTolerant({},Messages.StrictDuplicateProperty)}else if(kind!==PropertyKind.Data){throwErrorTolerant({},Messages.AccessorDataProperty)}}else{if(kind===PropertyKind.Data){throwErrorTolerant({},Messages.AccessorDataProperty)}else if(map[key]&kind){throwErrorTolerant({},Messages.AccessorGetSet)}}map[key]|=kind}else{map[key]=kind}properties.push(property);if(!match("}")){expect(",")}}expect("}");return delegate.markEnd(delegate.createObjectExpression(properties),startToken)}function parseGroupExpression(){var expr;expect("(");expr=parseExpression();expect(")");return expr}function parsePrimaryExpression(){var type,token,expr,startToken;if(match("(")){return parseGroupExpression()}if(match("[")){return parseArrayInitialiser()}if(match("{")){return parseObjectInitialiser()}type=lookahead.type;startToken=lookahead;if(type===Token.Identifier){expr=delegate.createIdentifier(lex().value)}else if(type===Token.StringLiteral||type===Token.NumericLiteral){if(strict&&lookahead.octal){throwErrorTolerant(lookahead,Messages.StrictOctalLiteral)}expr=delegate.createLiteral(lex())}else if(type===Token.Keyword){if(matchKeyword("function")){return parseFunctionExpression()}if(matchKeyword("this")){lex();expr=delegate.createThisExpression()}else{throwUnexpected(lex())}}else if(type===Token.BooleanLiteral){token=lex();token.value=token.value==="true";expr=delegate.createLiteral(token)}else if(type===Token.NullLiteral){token=lex();token.value=null;expr=delegate.createLiteral(token)}else if(match("/")||match("/=")){if(typeof extra.tokens!=="undefined"){expr=delegate.createLiteral(collectRegex())}else{expr=delegate.createLiteral(scanRegExp())}peek()}else{throwUnexpected(lex())}return delegate.markEnd(expr,startToken)}function parseArguments(){var args=[];expect("(");if(!match(")")){while(index<length){args.push(parseAssignmentExpression());if(match(")")){break}expect(",")}}expect(")");return args}function parseNonComputedProperty(){var token,startToken;startToken=lookahead;token=lex();if(!isIdentifierName(token)){throwUnexpected(token)}return delegate.markEnd(delegate.createIdentifier(token.value),startToken)}function parseNonComputedMember(){expect(".");return parseNonComputedProperty()}function parseComputedMember(){var expr;expect("[");expr=parseExpression();expect("]");return expr}function parseNewExpression(){var callee,args,startToken;startToken=lookahead;expectKeyword("new");callee=parseLeftHandSideExpression();args=match("(")?parseArguments():[];return delegate.markEnd(delegate.createNewExpression(callee,args),startToken)}function parseLeftHandSideExpressionAllowCall(){var previousAllowIn,expr,args,property,startToken;startToken=lookahead;previousAllowIn=state.allowIn;state.allowIn=true;expr=matchKeyword("new")?parseNewExpression():parsePrimaryExpression();state.allowIn=previousAllowIn;for(;;){if(match(".")){property=parseNonComputedMember();expr=delegate.createMemberExpression(".",expr,property)}else if(match("(")){args=parseArguments();expr=delegate.createCallExpression(expr,args)}else if(match("[")){property=parseComputedMember();expr=delegate.createMemberExpression("[",expr,property)}else{break}delegate.markEnd(expr,startToken)}return expr}function parseLeftHandSideExpression(){var previousAllowIn,expr,property,startToken;startToken=lookahead;previousAllowIn=state.allowIn;expr=matchKeyword("new")?parseNewExpression():parsePrimaryExpression();state.allowIn=previousAllowIn;while(match(".")||match("[")){if(match("[")){property=parseComputedMember();expr=delegate.createMemberExpression("[",expr,property)}else{property=parseNonComputedMember();expr=delegate.createMemberExpression(".",expr,property)}delegate.markEnd(expr,startToken)}return expr}function parsePostfixExpression(){var expr,token,startToken=lookahead;expr=parseLeftHandSideExpressionAllowCall();if(lookahead.type===Token.Punctuator){if((match("++")||match("--"))&&!peekLineTerminator()){if(strict&&expr.type===Syntax.Identifier&&isRestrictedWord(expr.name)){throwErrorTolerant({},Messages.StrictLHSPostfix)}if(!isLeftHandSide(expr)){throwErrorTolerant({},Messages.InvalidLHSInAssignment)}token=lex();expr=delegate.markEnd(delegate.createPostfixExpression(token.value,expr),startToken)}}return expr}function parseUnaryExpression(){var token,expr,startToken;if(lookahead.type!==Token.Punctuator&&lookahead.type!==Token.Keyword){expr=parsePostfixExpression()}else if(match("++")||match("--")){startToken=lookahead;token=lex();expr=parseUnaryExpression();if(strict&&expr.type===Syntax.Identifier&&isRestrictedWord(expr.name)){throwErrorTolerant({},Messages.StrictLHSPrefix)}if(!isLeftHandSide(expr)){throwErrorTolerant({},Messages.InvalidLHSInAssignment)}expr=delegate.createUnaryExpression(token.value,expr);expr=delegate.markEnd(expr,startToken)}else if(match("+")||match("-")||match("~")||match("!")){startToken=lookahead;token=lex();expr=parseUnaryExpression();expr=delegate.createUnaryExpression(token.value,expr);expr=delegate.markEnd(expr,startToken)}else if(matchKeyword("delete")||matchKeyword("void")||matchKeyword("typeof")){startToken=lookahead;token=lex();expr=parseUnaryExpression();expr=delegate.createUnaryExpression(token.value,expr);expr=delegate.markEnd(expr,startToken);if(strict&&expr.operator==="delete"&&expr.argument.type===Syntax.Identifier){throwErrorTolerant({},Messages.StrictDelete)}}else{expr=parsePostfixExpression()}return expr}function binaryPrecedence(token,allowIn){var prec=0;if(token.type!==Token.Punctuator&&token.type!==Token.Keyword){return 0}switch(token.value){case"||":prec=1;break;case"&&":prec=2;break;case"|":prec=3;break;case"^":prec=4;break;case"&":prec=5;break;case"==":case"!=":case"===":case"!==":prec=6;break;case"<":case">":case"<=":case">=":case"instanceof":prec=7;break;case"in":prec=allowIn?7:0;break;case"<<":case">>":case">>>":prec=8;break;case"+":case"-":prec=9;break;case"*":case"/":case"%":prec=11;break;default:break}return prec}function parseBinaryExpression(){var marker,markers,expr,token,prec,stack,right,operator,left,i;marker=lookahead;left=parseUnaryExpression();token=lookahead;prec=binaryPrecedence(token,state.allowIn);if(prec===0){return left}token.prec=prec;lex();markers=[marker,lookahead];right=parseUnaryExpression();stack=[left,token,right];while((prec=binaryPrecedence(lookahead,state.allowIn))>0){while(stack.length>2&&prec<=stack[stack.length-2].prec){right=stack.pop();operator=stack.pop().value;left=stack.pop();expr=delegate.createBinaryExpression(operator,left,right);markers.pop();marker=markers[markers.length-1];delegate.markEnd(expr,marker);stack.push(expr)}token=lex();token.prec=prec;stack.push(token);markers.push(lookahead);expr=parseUnaryExpression();stack.push(expr)}i=stack.length-1;expr=stack[i];markers.pop();while(i>1){expr=delegate.createBinaryExpression(stack[i-1].value,stack[i-2],expr);i-=2;marker=markers.pop();delegate.markEnd(expr,marker)}return expr}function parseConditionalExpression(){var expr,previousAllowIn,consequent,alternate,startToken;startToken=lookahead;expr=parseBinaryExpression();if(match("?")){lex();previousAllowIn=state.allowIn;state.allowIn=true;consequent=parseAssignmentExpression();state.allowIn=previousAllowIn;expect(":");alternate=parseAssignmentExpression();expr=delegate.createConditionalExpression(expr,consequent,alternate);delegate.markEnd(expr,startToken)}return expr}function parseAssignmentExpression(){var token,left,right,node,startToken;token=lookahead;startToken=lookahead;node=left=parseConditionalExpression();if(matchAssign()){if(!isLeftHandSide(left)){throwErrorTolerant({},Messages.InvalidLHSInAssignment)}if(strict&&left.type===Syntax.Identifier&&isRestrictedWord(left.name)){throwErrorTolerant(token,Messages.StrictLHSAssignment)}token=lex();right=parseAssignmentExpression();node=delegate.markEnd(delegate.createAssignmentExpression(token.value,left,right),startToken)}return node}function parseExpression(){var expr,startToken=lookahead;expr=parseAssignmentExpression();if(match(",")){expr=delegate.createSequenceExpression([expr]);while(index<length){if(!match(",")){break}lex();expr.expressions.push(parseAssignmentExpression())}delegate.markEnd(expr,startToken)}return expr}function parseStatementList(){var list=[],statement;while(index<length){if(match("}")){break}statement=parseSourceElement();if(typeof statement==="undefined"){break}list.push(statement)}return list}function parseBlock(){var block,startToken;startToken=lookahead;expect("{");block=parseStatementList();expect("}");return delegate.markEnd(delegate.createBlockStatement(block),startToken)}function parseVariableIdentifier(){var token,startToken;startToken=lookahead;token=lex();if(token.type!==Token.Identifier){throwUnexpected(token)}return delegate.markEnd(delegate.createIdentifier(token.value),startToken)}function parseVariableDeclaration(kind){var init=null,id,startToken;startToken=lookahead;id=parseVariableIdentifier();if(strict&&isRestrictedWord(id.name)){throwErrorTolerant({},Messages.StrictVarName)}if(kind==="const"){expect("=");init=parseAssignmentExpression()}else if(match("=")){lex();init=parseAssignmentExpression()}return delegate.markEnd(delegate.createVariableDeclarator(id,init),startToken)}function parseVariableDeclarationList(kind){var list=[];do{list.push(parseVariableDeclaration(kind));if(!match(",")){break}lex()}while(index<length);return list}function parseVariableStatement(){var declarations;expectKeyword("var");declarations=parseVariableDeclarationList();consumeSemicolon();return delegate.createVariableDeclaration(declarations,"var")}function parseConstLetDeclaration(kind){var declarations,startToken;startToken=lookahead;expectKeyword(kind);declarations=parseVariableDeclarationList(kind);consumeSemicolon();return delegate.markEnd(delegate.createVariableDeclaration(declarations,kind),startToken)}function parseEmptyStatement(){expect(";");return delegate.createEmptyStatement()}function parseExpressionStatement(){var expr=parseExpression();consumeSemicolon();return delegate.createExpressionStatement(expr)}function parseIfStatement(){var test,consequent,alternate;expectKeyword("if");expect("(");test=parseExpression();expect(")");consequent=parseStatement();if(matchKeyword("else")){lex();alternate=parseStatement()}else{alternate=null}return delegate.createIfStatement(test,consequent,alternate)}function parseDoWhileStatement(){var body,test,oldInIteration;expectKeyword("do");oldInIteration=state.inIteration;state.inIteration=true;body=parseStatement();state.inIteration=oldInIteration;expectKeyword("while");expect("(");test=parseExpression();expect(")");if(match(";")){lex()}return delegate.createDoWhileStatement(body,test)}function parseWhileStatement(){var test,body,oldInIteration;expectKeyword("while");expect("(");test=parseExpression();expect(")");oldInIteration=state.inIteration;state.inIteration=true;body=parseStatement();state.inIteration=oldInIteration;return delegate.createWhileStatement(test,body)}function parseForVariableDeclaration(){var token,declarations,startToken;startToken=lookahead;token=lex();declarations=parseVariableDeclarationList();return delegate.markEnd(delegate.createVariableDeclaration(declarations,token.value),startToken)}function parseForStatement(){var init,test,update,left,right,body,oldInIteration;init=test=update=null;expectKeyword("for");expect("(");if(match(";")){lex()}else{if(matchKeyword("var")||matchKeyword("let")){state.allowIn=false;init=parseForVariableDeclaration();state.allowIn=true;if(init.declarations.length===1&&matchKeyword("in")){lex();left=init;right=parseExpression();init=null}}else{state.allowIn=false;init=parseExpression();state.allowIn=true;if(matchKeyword("in")){if(!isLeftHandSide(init)){throwErrorTolerant({},Messages.InvalidLHSInForIn)}lex();left=init;right=parseExpression();init=null}}if(typeof left==="undefined"){expect(";")}}if(typeof left==="undefined"){if(!match(";")){test=parseExpression()}expect(";");if(!match(")")){update=parseExpression()}}expect(")");oldInIteration=state.inIteration;state.inIteration=true;body=parseStatement();state.inIteration=oldInIteration;return typeof left==="undefined"?delegate.createForStatement(init,test,update,body):delegate.createForInStatement(left,right,body)}function parseContinueStatement(){var label=null,key;expectKeyword("continue");if(source.charCodeAt(index)===59){lex();if(!state.inIteration){throwError({},Messages.IllegalContinue)}return delegate.createContinueStatement(null)}if(peekLineTerminator()){if(!state.inIteration){throwError({},Messages.IllegalContinue)}return delegate.createContinueStatement(null)}if(lookahead.type===Token.Identifier){label=parseVariableIdentifier();key="$"+label.name;if(!Object.prototype.hasOwnProperty.call(state.labelSet,key)){throwError({},Messages.UnknownLabel,label.name)}}consumeSemicolon();if(label===null&&!state.inIteration){throwError({},Messages.IllegalContinue)}return delegate.createContinueStatement(label)}function parseBreakStatement(){var label=null,key;expectKeyword("break");if(source.charCodeAt(index)===59){lex();if(!(state.inIteration||state.inSwitch)){throwError({},Messages.IllegalBreak)}return delegate.createBreakStatement(null)}if(peekLineTerminator()){if(!(state.inIteration||state.inSwitch)){throwError({},Messages.IllegalBreak)}return delegate.createBreakStatement(null)}if(lookahead.type===Token.Identifier){label=parseVariableIdentifier();key="$"+label.name;if(!Object.prototype.hasOwnProperty.call(state.labelSet,key)){throwError({},Messages.UnknownLabel,label.name)}}consumeSemicolon();if(label===null&&!(state.inIteration||state.inSwitch)){throwError({},Messages.IllegalBreak)}return delegate.createBreakStatement(label)}function parseReturnStatement(){var argument=null;expectKeyword("return");if(!state.inFunctionBody){throwErrorTolerant({},Messages.IllegalReturn)}if(source.charCodeAt(index)===32){if(isIdentifierStart(source.charCodeAt(index+1))){argument=parseExpression();consumeSemicolon();return delegate.createReturnStatement(argument)}}if(peekLineTerminator()){return delegate.createReturnStatement(null)}if(!match(";")){if(!match("}")&&lookahead.type!==Token.EOF){argument=parseExpression()}}consumeSemicolon();return delegate.createReturnStatement(argument)}function parseWithStatement(){var object,body;if(strict){skipComment();throwErrorTolerant({},Messages.StrictModeWith)}expectKeyword("with");expect("(");object=parseExpression();expect(")");body=parseStatement();return delegate.createWithStatement(object,body)}function parseSwitchCase(){var test,consequent=[],statement,startToken;startToken=lookahead;if(matchKeyword("default")){lex();test=null}else{expectKeyword("case");test=parseExpression()}expect(":");while(index<length){if(match("}")||matchKeyword("default")||matchKeyword("case")){break}statement=parseStatement();consequent.push(statement)}return delegate.markEnd(delegate.createSwitchCase(test,consequent),startToken)}function parseSwitchStatement(){var discriminant,cases,clause,oldInSwitch,defaultFound;expectKeyword("switch");expect("(");discriminant=parseExpression();expect(")");expect("{");cases=[];if(match("}")){lex();return delegate.createSwitchStatement(discriminant,cases)}oldInSwitch=state.inSwitch;state.inSwitch=true;defaultFound=false;while(index<length){if(match("}")){break}clause=parseSwitchCase();if(clause.test===null){if(defaultFound){throwError({},Messages.MultipleDefaultsInSwitch)}defaultFound=true}cases.push(clause)}state.inSwitch=oldInSwitch;expect("}");return delegate.createSwitchStatement(discriminant,cases)}function parseThrowStatement(){var argument;expectKeyword("throw");if(peekLineTerminator()){throwError({},Messages.NewlineAfterThrow)}argument=parseExpression();consumeSemicolon();return delegate.createThrowStatement(argument)}function parseCatchClause(){var param,body,startToken;startToken=lookahead;expectKeyword("catch");expect("(");if(match(")")){throwUnexpected(lookahead)}param=parseVariableIdentifier();if(strict&&isRestrictedWord(param.name)){throwErrorTolerant({},Messages.StrictCatchVariable)}expect(")");body=parseBlock();return delegate.markEnd(delegate.createCatchClause(param,body),startToken)}function parseTryStatement(){var block,handlers=[],finalizer=null;expectKeyword("try");block=parseBlock();if(matchKeyword("catch")){handlers.push(parseCatchClause())}if(matchKeyword("finally")){lex();finalizer=parseBlock()}if(handlers.length===0&&!finalizer){throwError({},Messages.NoCatchOrFinally)}return delegate.createTryStatement(block,[],handlers,finalizer)}function parseDebuggerStatement(){expectKeyword("debugger");consumeSemicolon();return delegate.createDebuggerStatement()}function parseStatement(){var type=lookahead.type,expr,labeledBody,key,startToken;if(type===Token.EOF){throwUnexpected(lookahead)}if(type===Token.Punctuator&&lookahead.value==="{"){return parseBlock()}startToken=lookahead;if(type===Token.Punctuator){switch(lookahead.value){case";":return delegate.markEnd(parseEmptyStatement(),startToken);case"(":return delegate.markEnd(parseExpressionStatement(),startToken);default:break}}if(type===Token.Keyword){switch(lookahead.value){case"break":return delegate.markEnd(parseBreakStatement(),startToken);case"continue":return delegate.markEnd(parseContinueStatement(),startToken);case"debugger":return delegate.markEnd(parseDebuggerStatement(),startToken);case"do":return delegate.markEnd(parseDoWhileStatement(),startToken);case"for":return delegate.markEnd(parseForStatement(),startToken);case"function":return delegate.markEnd(parseFunctionDeclaration(),startToken);case"if":return delegate.markEnd(parseIfStatement(),startToken);case"return":return delegate.markEnd(parseReturnStatement(),startToken);case"switch":return delegate.markEnd(parseSwitchStatement(),startToken);case"throw":return delegate.markEnd(parseThrowStatement(),startToken);case"try":return delegate.markEnd(parseTryStatement(),startToken);case"var":return delegate.markEnd(parseVariableStatement(),startToken);case"while":return delegate.markEnd(parseWhileStatement(),startToken);case"with":return delegate.markEnd(parseWithStatement(),startToken);default:break}}expr=parseExpression();if(expr.type===Syntax.Identifier&&match(":")){lex();key="$"+expr.name;if(Object.prototype.hasOwnProperty.call(state.labelSet,key)){throwError({},Messages.Redeclaration,"Label",expr.name)}state.labelSet[key]=true;labeledBody=parseStatement();delete state.labelSet[key];return delegate.markEnd(delegate.createLabeledStatement(expr,labeledBody),startToken)}consumeSemicolon();return delegate.markEnd(delegate.createExpressionStatement(expr),startToken)}function parseFunctionSourceElements(){var sourceElement,sourceElements=[],token,directive,firstRestricted,oldLabelSet,oldInIteration,oldInSwitch,oldInFunctionBody,startToken;startToken=lookahead;expect("{");while(index<length){if(lookahead.type!==Token.StringLiteral){break}token=lookahead;sourceElement=parseSourceElement();sourceElements.push(sourceElement);if(sourceElement.expression.type!==Syntax.Literal){break}directive=source.slice(token.start+1,token.end-1);if(directive==="use strict"){strict=true;if(firstRestricted){throwErrorTolerant(firstRestricted,Messages.StrictOctalLiteral)}}else{if(!firstRestricted&&token.octal){firstRestricted=token}}}oldLabelSet=state.labelSet;oldInIteration=state.inIteration;oldInSwitch=state.inSwitch;oldInFunctionBody=state.inFunctionBody;state.labelSet={};state.inIteration=false;state.inSwitch=false;state.inFunctionBody=true;while(index<length){if(match("}")){break}sourceElement=parseSourceElement();if(typeof sourceElement==="undefined"){break}sourceElements.push(sourceElement)}expect("}");state.labelSet=oldLabelSet;state.inIteration=oldInIteration;state.inSwitch=oldInSwitch;state.inFunctionBody=oldInFunctionBody;return delegate.markEnd(delegate.createBlockStatement(sourceElements),startToken)}function parseParams(firstRestricted){var param,params=[],token,stricted,paramSet,key,message;expect("(");if(!match(")")){paramSet={};while(index<length){token=lookahead;param=parseVariableIdentifier();key="$"+token.value;if(strict){if(isRestrictedWord(token.value)){stricted=token;message=Messages.StrictParamName}if(Object.prototype.hasOwnProperty.call(paramSet,key)){stricted=token;message=Messages.StrictParamDupe}}else if(!firstRestricted){if(isRestrictedWord(token.value)){firstRestricted=token;message=Messages.StrictParamName}else if(isStrictModeReservedWord(token.value)){firstRestricted=token;message=Messages.StrictReservedWord}else if(Object.prototype.hasOwnProperty.call(paramSet,key)){firstRestricted=token;message=Messages.StrictParamDupe}}params.push(param);paramSet[key]=true;if(match(")")){break}expect(",")}}expect(")");return{params:params,stricted:stricted,firstRestricted:firstRestricted,message:message}}function parseFunctionDeclaration(){var id,params=[],body,token,stricted,tmp,firstRestricted,message,previousStrict,startToken;startToken=lookahead;expectKeyword("function");token=lookahead;id=parseVariableIdentifier();if(strict){if(isRestrictedWord(token.value)){throwErrorTolerant(token,Messages.StrictFunctionName)}}else{if(isRestrictedWord(token.value)){firstRestricted=token;message=Messages.StrictFunctionName}else if(isStrictModeReservedWord(token.value)){firstRestricted=token;message=Messages.StrictReservedWord}}tmp=parseParams(firstRestricted);params=tmp.params;stricted=tmp.stricted;firstRestricted=tmp.firstRestricted;if(tmp.message){message=tmp.message}previousStrict=strict;body=parseFunctionSourceElements();if(strict&&firstRestricted){throwError(firstRestricted,message)}if(strict&&stricted){throwErrorTolerant(stricted,message)}strict=previousStrict;return delegate.markEnd(delegate.createFunctionDeclaration(id,params,[],body),startToken)}function parseFunctionExpression(){var token,id=null,stricted,firstRestricted,message,tmp,params=[],body,previousStrict,startToken;startToken=lookahead;expectKeyword("function");if(!match("(")){token=lookahead;id=parseVariableIdentifier();if(strict){if(isRestrictedWord(token.value)){throwErrorTolerant(token,Messages.StrictFunctionName)}}else{if(isRestrictedWord(token.value)){firstRestricted=token;message=Messages.StrictFunctionName}else if(isStrictModeReservedWord(token.value)){firstRestricted=token;message=Messages.StrictReservedWord}}}tmp=parseParams(firstRestricted);params=tmp.params;stricted=tmp.stricted;firstRestricted=tmp.firstRestricted;if(tmp.message){message=tmp.message}previousStrict=strict;body=parseFunctionSourceElements();if(strict&&firstRestricted){throwError(firstRestricted,message)}if(strict&&stricted){throwErrorTolerant(stricted,message)}strict=previousStrict;return delegate.markEnd(delegate.createFunctionExpression(id,params,[],body),startToken)}function parseSourceElement(){if(lookahead.type===Token.Keyword){switch(lookahead.value){case"const":case"let":return parseConstLetDeclaration(lookahead.value);case"function":return parseFunctionDeclaration();default:return parseStatement()}}if(lookahead.type!==Token.EOF){return parseStatement()}}function parseSourceElements(){var sourceElement,sourceElements=[],token,directive,firstRestricted;while(index<length){token=lookahead;if(token.type!==Token.StringLiteral){break}sourceElement=parseSourceElement();sourceElements.push(sourceElement);if(sourceElement.expression.type!==Syntax.Literal){break}directive=source.slice(token.start+1,token.end-1);if(directive==="use strict"){strict=true;if(firstRestricted){throwErrorTolerant(firstRestricted,Messages.StrictOctalLiteral)}}else{if(!firstRestricted&&token.octal){firstRestricted=token}}}while(index<length){sourceElement=parseSourceElement();if(typeof sourceElement==="undefined"){break}sourceElements.push(sourceElement)}return sourceElements}function parseProgram(){var body,startToken;skipComment();peek();startToken=lookahead;strict=false;body=parseSourceElements();return delegate.markEnd(delegate.createProgram(body),startToken)}function filterTokenLocation(){var i,entry,token,tokens=[];for(i=0;i<extra.tokens.length;++i){entry=extra.tokens[i];token={type:entry.type,value:entry.value};if(extra.range){token.range=entry.range}if(extra.loc){token.loc=entry.loc}tokens.push(token)}extra.tokens=tokens}function tokenize(code,options){var toString,token,tokens;toString=String;if(typeof code!=="string"&&!(code instanceof String)){code=toString(code)}delegate=SyntaxTreeDelegate;source=code;index=0;lineNumber=source.length>0?1:0;lineStart=0;length=source.length;lookahead=null;state={allowIn:true,labelSet:{},inFunctionBody:false,inIteration:false,inSwitch:false,lastCommentStart:-1};extra={};options=options||{};options.tokens=true;extra.tokens=[];extra.tokenize=true;extra.openParenToken=-1;extra.openCurlyToken=-1;extra.range=typeof options.range==="boolean"&&options.range;extra.loc=typeof options.loc==="boolean"&&options.loc;if(typeof options.comment==="boolean"&&options.comment){extra.comments=[]}if(typeof options.tolerant==="boolean"&&options.tolerant){extra.errors=[]}try{peek();if(lookahead.type===Token.EOF){return extra.tokens}token=lex();while(lookahead.type!==Token.EOF){try{token=lex()}catch(lexError){token=lookahead;if(extra.errors){extra.errors.push(lexError);break}else{throw lexError}}}filterTokenLocation();tokens=extra.tokens;if(typeof extra.comments!=="undefined"){tokens.comments=extra.comments}if(typeof extra.errors!=="undefined"){tokens.errors=extra.errors}}catch(e){throw e}finally{extra={}}return tokens}function parse(code,options){var program,toString;toString=String;if(typeof code!=="string"&&!(code instanceof String)){code=toString(code)}delegate=SyntaxTreeDelegate;source=code;index=0;lineNumber=source.length>0?1:0;lineStart=0;length=source.length;lookahead=null;state={allowIn:true,labelSet:{},inFunctionBody:false,inIteration:false,inSwitch:false,lastCommentStart:-1};extra={};if(typeof options!=="undefined"){extra.range=typeof options.range==="boolean"&&options.range;extra.loc=typeof options.loc==="boolean"&&options.loc;extra.attachComment=typeof options.attachComment==="boolean"&&options.attachComment;if(extra.loc&&options.source!==null&&options.source!==undefined){extra.source=toString(options.source)}if(typeof options.tokens==="boolean"&&options.tokens){extra.tokens=[]}if(typeof options.comment==="boolean"&&options.comment){extra.comments=[]}if(typeof options.tolerant==="boolean"&&options.tolerant){extra.errors=[]}if(extra.attachComment){extra.range=true;extra.comments=[];extra.bottomRightStack=[];extra.trailingComments=[];extra.leadingComments=[]}}try{program=parseProgram();if(typeof extra.comments!=="undefined"){program.comments=extra.comments}if(typeof extra.tokens!=="undefined"){filterTokenLocation();program.tokens=extra.tokens}if(typeof extra.errors!=="undefined"){program.errors=extra.errors}}catch(e){throw e}finally{extra={}}return program}exports.version="1.2.3";exports.tokenize=tokenize;exports.parse=parse;exports.Syntax=function(){var name,types={};if(typeof Object.create==="function"){types=Object.create(null)}for(name in Syntax){if(Syntax.hasOwnProperty(name)){types[name]=Syntax[name]}}if(typeof Object.freeze==="function"){Object.freeze(types)}return types}()})},{}],13:[function(require,module,exports){(function(Buffer){(function(sax){sax.parser=function(strict,opt){return new SAXParser(strict,opt)};sax.SAXParser=SAXParser;sax.SAXStream=SAXStream;sax.createStream=createStream;sax.MAX_BUFFER_LENGTH=64*1024;var buffers=["comment","sgmlDecl","textNode","tagName","doctype","procInstName","procInstBody","entity","attribName","attribValue","cdata","script"];sax.EVENTS=["text","processinginstruction","sgmldeclaration","doctype","comment","attribute","opentag","closetag","opencdata","cdata","closecdata","error","end","ready","script","opennamespace","closenamespace"];function SAXParser(strict,opt){if(!(this instanceof SAXParser))return new SAXParser(strict,opt);var parser=this;clearBuffers(parser);parser.q=parser.c="";parser.bufferCheckPosition=sax.MAX_BUFFER_LENGTH;parser.opt=opt||{};parser.opt.lowercase=parser.opt.lowercase||parser.opt.lowercasetags;parser.looseCase=parser.opt.lowercase?"toLowerCase":"toUpperCase";parser.tags=[];parser.closed=parser.closedRoot=parser.sawRoot=false;parser.tag=parser.error=null;parser.strict=!!strict;parser.noscript=!!(strict||parser.opt.noscript);parser.state=S.BEGIN;parser.ENTITIES=Object.create(sax.ENTITIES);parser.attribList=[];if(parser.opt.xmlns)parser.ns=Object.create(rootNS);parser.trackPosition=parser.opt.position!==false;if(parser.trackPosition){parser.position=parser.line=parser.column=0}emit(parser,"onready")}if(!Object.create)Object.create=function(o){function f(){this.__proto__=o}f.prototype=o;return new f};if(!Object.getPrototypeOf)Object.getPrototypeOf=function(o){return o.__proto__};if(!Object.keys)Object.keys=function(o){var a=[];for(var i in o)if(o.hasOwnProperty(i))a.push(i);return a};function checkBufferLength(parser){var maxAllowed=Math.max(sax.MAX_BUFFER_LENGTH,10),maxActual=0;for(var i=0,l=buffers.length;i<l;i++){var len=parser[buffers[i]].length;if(len>maxAllowed){switch(buffers[i]){case"textNode":closeText(parser);break;case"cdata":emitNode(parser,"oncdata",parser.cdata);parser.cdata="";break;case"script":emitNode(parser,"onscript",parser.script);parser.script="";break;default:error(parser,"Max buffer length exceeded: "+buffers[i])}}maxActual=Math.max(maxActual,len)}parser.bufferCheckPosition=sax.MAX_BUFFER_LENGTH-maxActual+parser.position;

}function clearBuffers(parser){for(var i=0,l=buffers.length;i<l;i++){parser[buffers[i]]=""}}function flushBuffers(parser){closeText(parser);if(parser.cdata!==""){emitNode(parser,"oncdata",parser.cdata);parser.cdata=""}if(parser.script!==""){emitNode(parser,"onscript",parser.script);parser.script=""}}SAXParser.prototype={end:function(){end(this)},write:write,resume:function(){this.error=null;return this},close:function(){return this.write(null)},flush:function(){flushBuffers(this)}};try{var Stream=require("stream").Stream}catch(ex){var Stream=function(){}}var streamWraps=sax.EVENTS.filter(function(ev){return ev!=="error"&&ev!=="end"});function createStream(strict,opt){return new SAXStream(strict,opt)}function SAXStream(strict,opt){if(!(this instanceof SAXStream))return new SAXStream(strict,opt);Stream.apply(this);this._parser=new SAXParser(strict,opt);this.writable=true;this.readable=true;var me=this;this._parser.onend=function(){me.emit("end")};this._parser.onerror=function(er){me.emit("error",er);me._parser.error=null};this._decoder=null;streamWraps.forEach(function(ev){Object.defineProperty(me,"on"+ev,{get:function(){return me._parser["on"+ev]},set:function(h){if(!h){me.removeAllListeners(ev);return me._parser["on"+ev]=h}me.on(ev,h)},enumerable:true,configurable:false})})}SAXStream.prototype=Object.create(Stream.prototype,{constructor:{value:SAXStream}});SAXStream.prototype.write=function(data){if(typeof Buffer==="function"&&typeof Buffer.isBuffer==="function"&&Buffer.isBuffer(data)){if(!this._decoder){var SD=require("string_decoder").StringDecoder;this._decoder=new SD("utf8")}data=this._decoder.write(data)}this._parser.write(data.toString());this.emit("data",data);return true};SAXStream.prototype.end=function(chunk){if(chunk&&chunk.length)this.write(chunk);this._parser.end();return true};SAXStream.prototype.on=function(ev,handler){var me=this;if(!me._parser["on"+ev]&&streamWraps.indexOf(ev)!==-1){me._parser["on"+ev]=function(){var args=arguments.length===1?[arguments[0]]:Array.apply(null,arguments);args.splice(0,0,ev);me.emit.apply(me,args)}}return Stream.prototype.on.call(me,ev,handler)};var whitespace="\r\n	 ",number="0124356789",letter="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",quote="'\"",entity=number+letter+"#",attribEnd=whitespace+">",CDATA="[CDATA[",DOCTYPE="DOCTYPE",XML_NAMESPACE="http://www.w3.org/XML/1998/namespace",XMLNS_NAMESPACE="http://www.w3.org/2000/xmlns/",rootNS={xml:XML_NAMESPACE,xmlns:XMLNS_NAMESPACE};whitespace=charClass(whitespace);number=charClass(number);letter=charClass(letter);var nameStart=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/;var nameBody=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040\.\d-]/;quote=charClass(quote);entity=charClass(entity);attribEnd=charClass(attribEnd);function charClass(str){return str.split("").reduce(function(s,c){s[c]=true;return s},{})}function isRegExp(c){return Object.prototype.toString.call(c)==="[object RegExp]"}function is(charclass,c){return isRegExp(charclass)?!!c.match(charclass):charclass[c]}function not(charclass,c){return!is(charclass,c)}var S=0;sax.STATE={BEGIN:S++,TEXT:S++,TEXT_ENTITY:S++,OPEN_WAKA:S++,SGML_DECL:S++,SGML_DECL_QUOTED:S++,DOCTYPE:S++,DOCTYPE_QUOTED:S++,DOCTYPE_DTD:S++,DOCTYPE_DTD_QUOTED:S++,COMMENT_STARTING:S++,COMMENT:S++,COMMENT_ENDING:S++,COMMENT_ENDED:S++,CDATA:S++,CDATA_ENDING:S++,CDATA_ENDING_2:S++,PROC_INST:S++,PROC_INST_BODY:S++,PROC_INST_ENDING:S++,OPEN_TAG:S++,OPEN_TAG_SLASH:S++,ATTRIB:S++,ATTRIB_NAME:S++,ATTRIB_NAME_SAW_WHITE:S++,ATTRIB_VALUE:S++,ATTRIB_VALUE_QUOTED:S++,ATTRIB_VALUE_CLOSED:S++,ATTRIB_VALUE_UNQUOTED:S++,ATTRIB_VALUE_ENTITY_Q:S++,ATTRIB_VALUE_ENTITY_U:S++,CLOSE_TAG:S++,CLOSE_TAG_SAW_WHITE:S++,SCRIPT:S++,SCRIPT_ENDING:S++};sax.ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'",AElig:198,Aacute:193,Acirc:194,Agrave:192,Aring:197,Atilde:195,Auml:196,Ccedil:199,ETH:208,Eacute:201,Ecirc:202,Egrave:200,Euml:203,Iacute:205,Icirc:206,Igrave:204,Iuml:207,Ntilde:209,Oacute:211,Ocirc:212,Ograve:210,Oslash:216,Otilde:213,Ouml:214,THORN:222,Uacute:218,Ucirc:219,Ugrave:217,Uuml:220,Yacute:221,aacute:225,acirc:226,aelig:230,agrave:224,aring:229,atilde:227,auml:228,ccedil:231,eacute:233,ecirc:234,egrave:232,eth:240,euml:235,iacute:237,icirc:238,igrave:236,iuml:239,ntilde:241,oacute:243,ocirc:244,ograve:242,oslash:248,otilde:245,ouml:246,szlig:223,thorn:254,uacute:250,ucirc:251,ugrave:249,uuml:252,yacute:253,yuml:255,copy:169,reg:174,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,ordf:170,laquo:171,not:172,shy:173,macr:175,deg:176,plusmn:177,sup1:185,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,times:215,divide:247,OElig:338,oelig:339,Scaron:352,scaron:353,Yuml:376,fnof:402,circ:710,tilde:732,Alpha:913,Beta:914,Gamma:915,Delta:916,Epsilon:917,Zeta:918,Eta:919,Theta:920,Iota:921,Kappa:922,Lambda:923,Mu:924,Nu:925,Xi:926,Omicron:927,Pi:928,Rho:929,Sigma:931,Tau:932,Upsilon:933,Phi:934,Chi:935,Psi:936,Omega:937,alpha:945,beta:946,gamma:947,delta:948,epsilon:949,zeta:950,eta:951,theta:952,iota:953,kappa:954,lambda:955,mu:956,nu:957,xi:958,omicron:959,pi:960,rho:961,sigmaf:962,sigma:963,tau:964,upsilon:965,phi:966,chi:967,psi:968,omega:969,thetasym:977,upsih:978,piv:982,ensp:8194,emsp:8195,thinsp:8201,zwnj:8204,zwj:8205,lrm:8206,rlm:8207,ndash:8211,mdash:8212,lsquo:8216,rsquo:8217,sbquo:8218,ldquo:8220,rdquo:8221,bdquo:8222,dagger:8224,Dagger:8225,bull:8226,hellip:8230,permil:8240,prime:8242,Prime:8243,lsaquo:8249,rsaquo:8250,oline:8254,frasl:8260,euro:8364,image:8465,weierp:8472,real:8476,trade:8482,alefsym:8501,larr:8592,uarr:8593,rarr:8594,darr:8595,harr:8596,crarr:8629,lArr:8656,uArr:8657,rArr:8658,dArr:8659,hArr:8660,forall:8704,part:8706,exist:8707,empty:8709,nabla:8711,isin:8712,notin:8713,ni:8715,prod:8719,sum:8721,minus:8722,lowast:8727,radic:8730,prop:8733,infin:8734,ang:8736,and:8743,or:8744,cap:8745,cup:8746,"int":8747,there4:8756,sim:8764,cong:8773,asymp:8776,ne:8800,equiv:8801,le:8804,ge:8805,sub:8834,sup:8835,nsub:8836,sube:8838,supe:8839,oplus:8853,otimes:8855,perp:8869,sdot:8901,lceil:8968,rceil:8969,lfloor:8970,rfloor:8971,lang:9001,rang:9002,loz:9674,spades:9824,clubs:9827,hearts:9829,diams:9830};Object.keys(sax.ENTITIES).forEach(function(key){var e=sax.ENTITIES[key];var s=typeof e==="number"?String.fromCharCode(e):e;sax.ENTITIES[key]=s});for(var S in sax.STATE)sax.STATE[sax.STATE[S]]=S;S=sax.STATE;function emit(parser,event,data){parser[event]&&parser[event](data)}function emitNode(parser,nodeType,data){if(parser.textNode)closeText(parser);emit(parser,nodeType,data)}function closeText(parser){parser.textNode=textopts(parser.opt,parser.textNode);if(parser.textNode)emit(parser,"ontext",parser.textNode);parser.textNode=""}function textopts(opt,text){if(opt.trim)text=text.trim();if(opt.normalize)text=text.replace(/\s+/g," ");return text}function error(parser,er){closeText(parser);if(parser.trackPosition){er+="\nLine: "+parser.line+"\nColumn: "+parser.column+"\nChar: "+parser.c}er=new Error(er);parser.error=er;emit(parser,"onerror",er);return parser}function end(parser){if(!parser.closedRoot)strictFail(parser,"Unclosed root tag");if(parser.state!==S.BEGIN&&parser.state!==S.TEXT)error(parser,"Unexpected end");closeText(parser);parser.c="";parser.closed=true;emit(parser,"onend");SAXParser.call(parser,parser.strict,parser.opt);return parser}function strictFail(parser,message){if(typeof parser!=="object"||!(parser instanceof SAXParser))throw new Error("bad call to strictFail");if(parser.strict)error(parser,message)}function newTag(parser){if(!parser.strict)parser.tagName=parser.tagName[parser.looseCase]();var parent=parser.tags[parser.tags.length-1]||parser,tag=parser.tag={name:parser.tagName,attributes:{}};if(parser.opt.xmlns)tag.ns=parent.ns;parser.attribList.length=0}function qname(name,attribute){var i=name.indexOf(":"),qualName=i<0?["",name]:name.split(":"),prefix=qualName[0],local=qualName[1];if(attribute&&name==="xmlns"){prefix="xmlns";local=""}return{prefix:prefix,local:local}}function attrib(parser){if(!parser.strict)parser.attribName=parser.attribName[parser.looseCase]();if(parser.attribList.indexOf(parser.attribName)!==-1||parser.tag.attributes.hasOwnProperty(parser.attribName)){return parser.attribName=parser.attribValue=""}if(parser.opt.xmlns){var qn=qname(parser.attribName,true),prefix=qn.prefix,local=qn.local;if(prefix==="xmlns"){if(local==="xml"&&parser.attribValue!==XML_NAMESPACE){strictFail(parser,"xml: prefix must be bound to "+XML_NAMESPACE+"\n"+"Actual: "+parser.attribValue)}else if(local==="xmlns"&&parser.attribValue!==XMLNS_NAMESPACE){strictFail(parser,"xmlns: prefix must be bound to "+XMLNS_NAMESPACE+"\n"+"Actual: "+parser.attribValue)}else{var tag=parser.tag,parent=parser.tags[parser.tags.length-1]||parser;if(tag.ns===parent.ns){tag.ns=Object.create(parent.ns)}tag.ns[local]=parser.attribValue}}parser.attribList.push([parser.attribName,parser.attribValue])}else{parser.tag.attributes[parser.attribName]=parser.attribValue;emitNode(parser,"onattribute",{name:parser.attribName,value:parser.attribValue})}parser.attribName=parser.attribValue=""}function openTag(parser,selfClosing){if(parser.opt.xmlns){var tag=parser.tag;var qn=qname(parser.tagName);tag.prefix=qn.prefix;tag.local=qn.local;tag.uri=tag.ns[qn.prefix]||"";if(tag.prefix&&!tag.uri){strictFail(parser,"Unbound namespace prefix: "+JSON.stringify(parser.tagName));tag.uri=qn.prefix}var parent=parser.tags[parser.tags.length-1]||parser;if(tag.ns&&parent.ns!==tag.ns){Object.keys(tag.ns).forEach(function(p){emitNode(parser,"onopennamespace",{prefix:p,uri:tag.ns[p]})})}for(var i=0,l=parser.attribList.length;i<l;i++){var nv=parser.attribList[i];var name=nv[0],value=nv[1],qualName=qname(name,true),prefix=qualName.prefix,local=qualName.local,uri=prefix==""?"":tag.ns[prefix]||"",a={name:name,value:value,prefix:prefix,local:local,uri:uri};if(prefix&&prefix!="xmlns"&&!uri){strictFail(parser,"Unbound namespace prefix: "+JSON.stringify(prefix));a.uri=prefix}parser.tag.attributes[name]=a;emitNode(parser,"onattribute",a)}parser.attribList.length=0}parser.tag.isSelfClosing=!!selfClosing;parser.sawRoot=true;parser.tags.push(parser.tag);emitNode(parser,"onopentag",parser.tag);if(!selfClosing){if(!parser.noscript&&parser.tagName.toLowerCase()==="script"){parser.state=S.SCRIPT}else{parser.state=S.TEXT}parser.tag=null;parser.tagName=""}parser.attribName=parser.attribValue="";parser.attribList.length=0}function closeTag(parser){if(!parser.tagName){strictFail(parser,"Weird empty close tag.");parser.textNode+="</>";parser.state=S.TEXT;return}if(parser.script){if(parser.tagName!=="script"){parser.script+="</"+parser.tagName+">";parser.tagName="";parser.state=S.SCRIPT;return}emitNode(parser,"onscript",parser.script);parser.script=""}var t=parser.tags.length;var tagName=parser.tagName;if(!parser.strict)tagName=tagName[parser.looseCase]();var closeTo=tagName;while(t--){var close=parser.tags[t];if(close.name!==closeTo){strictFail(parser,"Unexpected close tag")}else break}if(t<0){strictFail(parser,"Unmatched closing tag: "+parser.tagName);parser.textNode+="</"+parser.tagName+">";parser.state=S.TEXT;return}parser.tagName=tagName;var s=parser.tags.length;while(s-->t){var tag=parser.tag=parser.tags.pop();parser.tagName=parser.tag.name;emitNode(parser,"onclosetag",parser.tagName);var x={};for(var i in tag.ns)x[i]=tag.ns[i];var parent=parser.tags[parser.tags.length-1]||parser;if(parser.opt.xmlns&&tag.ns!==parent.ns){Object.keys(tag.ns).forEach(function(p){var n=tag.ns[p];emitNode(parser,"onclosenamespace",{prefix:p,uri:n})})}}if(t===0)parser.closedRoot=true;parser.tagName=parser.attribValue=parser.attribName="";parser.attribList.length=0;parser.state=S.TEXT}function parseEntity(parser){var entity=parser.entity,entityLC=entity.toLowerCase(),num,numStr="";if(parser.ENTITIES[entity])return parser.ENTITIES[entity];if(parser.ENTITIES[entityLC])return parser.ENTITIES[entityLC];entity=entityLC;if(entity.charAt(0)==="#"){if(entity.charAt(1)==="x"){entity=entity.slice(2);num=parseInt(entity,16);numStr=num.toString(16)}else{entity=entity.slice(1);num=parseInt(entity,10);numStr=num.toString(10)}}entity=entity.replace(/^0+/,"");if(numStr.toLowerCase()!==entity){strictFail(parser,"Invalid character entity");return"&"+parser.entity+";"}return String.fromCodePoint(num)}function write(chunk){var parser=this;if(this.error)throw this.error;if(parser.closed)return error(parser,"Cannot write after close. Assign an onready handler.");if(chunk===null)return end(parser);var i=0,c="";while(parser.c=c=chunk.charAt(i++)){if(parser.trackPosition){parser.position++;if(c==="\n"){parser.line++;parser.column=0}else parser.column++}switch(parser.state){case S.BEGIN:if(c==="<"){parser.state=S.OPEN_WAKA;parser.startTagPosition=parser.position}else if(not(whitespace,c)){strictFail(parser,"Non-whitespace before first tag.");parser.textNode=c;parser.state=S.TEXT}continue;case S.TEXT:if(parser.sawRoot&&!parser.closedRoot){var starti=i-1;while(c&&c!=="<"&&c!=="&"){c=chunk.charAt(i++);if(c&&parser.trackPosition){parser.position++;if(c==="\n"){parser.line++;parser.column=0}else parser.column++}}parser.textNode+=chunk.substring(starti,i-1)}if(c==="<"){parser.state=S.OPEN_WAKA;parser.startTagPosition=parser.position}else{if(not(whitespace,c)&&(!parser.sawRoot||parser.closedRoot))strictFail(parser,"Text data outside of root node.");if(c==="&")parser.state=S.TEXT_ENTITY;else parser.textNode+=c}continue;case S.SCRIPT:if(c==="<"){parser.state=S.SCRIPT_ENDING}else parser.script+=c;continue;case S.SCRIPT_ENDING:if(c==="/"){parser.state=S.CLOSE_TAG}else{parser.script+="<"+c;parser.state=S.SCRIPT}continue;case S.OPEN_WAKA:if(c==="!"){parser.state=S.SGML_DECL;parser.sgmlDecl=""}else if(is(whitespace,c)){}else if(is(nameStart,c)){parser.state=S.OPEN_TAG;parser.tagName=c}else if(c==="/"){parser.state=S.CLOSE_TAG;parser.tagName=""}else if(c==="?"){parser.state=S.PROC_INST;parser.procInstName=parser.procInstBody=""}else{strictFail(parser,"Unencoded <");if(parser.startTagPosition+1<parser.position){var pad=parser.position-parser.startTagPosition;c=new Array(pad).join(" ")+c}parser.textNode+="<"+c;parser.state=S.TEXT}continue;case S.SGML_DECL:if((parser.sgmlDecl+c).toUpperCase()===CDATA){emitNode(parser,"onopencdata");parser.state=S.CDATA;parser.sgmlDecl="";parser.cdata=""}else if(parser.sgmlDecl+c==="--"){parser.state=S.COMMENT;parser.comment="";parser.sgmlDecl=""}else if((parser.sgmlDecl+c).toUpperCase()===DOCTYPE){parser.state=S.DOCTYPE;if(parser.doctype||parser.sawRoot)strictFail(parser,"Inappropriately located doctype declaration");parser.doctype="";parser.sgmlDecl=""}else if(c===">"){emitNode(parser,"onsgmldeclaration",parser.sgmlDecl);parser.sgmlDecl="";parser.state=S.TEXT}else if(is(quote,c)){parser.state=S.SGML_DECL_QUOTED;parser.sgmlDecl+=c}else parser.sgmlDecl+=c;continue;case S.SGML_DECL_QUOTED:if(c===parser.q){parser.state=S.SGML_DECL;parser.q=""}parser.sgmlDecl+=c;continue;case S.DOCTYPE:if(c===">"){parser.state=S.TEXT;emitNode(parser,"ondoctype",parser.doctype);parser.doctype=true}else{parser.doctype+=c;if(c==="[")parser.state=S.DOCTYPE_DTD;else if(is(quote,c)){parser.state=S.DOCTYPE_QUOTED;parser.q=c}}continue;case S.DOCTYPE_QUOTED:parser.doctype+=c;if(c===parser.q){parser.q="";parser.state=S.DOCTYPE}continue;case S.DOCTYPE_DTD:parser.doctype+=c;if(c==="]")parser.state=S.DOCTYPE;else if(is(quote,c)){parser.state=S.DOCTYPE_DTD_QUOTED;parser.q=c}continue;case S.DOCTYPE_DTD_QUOTED:parser.doctype+=c;if(c===parser.q){parser.state=S.DOCTYPE_DTD;parser.q=""}continue;case S.COMMENT:if(c==="-")parser.state=S.COMMENT_ENDING;else parser.comment+=c;continue;case S.COMMENT_ENDING:if(c==="-"){parser.state=S.COMMENT_ENDED;parser.comment=textopts(parser.opt,parser.comment);if(parser.comment)emitNode(parser,"oncomment",parser.comment);parser.comment=""}else{parser.comment+="-"+c;parser.state=S.COMMENT}continue;case S.COMMENT_ENDED:if(c!==">"){strictFail(parser,"Malformed comment");parser.comment+="--"+c;parser.state=S.COMMENT}else parser.state=S.TEXT;continue;case S.CDATA:if(c==="]")parser.state=S.CDATA_ENDING;else parser.cdata+=c;continue;case S.CDATA_ENDING:if(c==="]")parser.state=S.CDATA_ENDING_2;else{parser.cdata+="]"+c;parser.state=S.CDATA}continue;case S.CDATA_ENDING_2:if(c===">"){if(parser.cdata)emitNode(parser,"oncdata",parser.cdata);emitNode(parser,"onclosecdata");parser.cdata="";parser.state=S.TEXT}else if(c==="]"){parser.cdata+="]"}else{parser.cdata+="]]"+c;parser.state=S.CDATA}continue;case S.PROC_INST:if(c==="?")parser.state=S.PROC_INST_ENDING;else if(is(whitespace,c))parser.state=S.PROC_INST_BODY;else parser.procInstName+=c;continue;case S.PROC_INST_BODY:if(!parser.procInstBody&&is(whitespace,c))continue;else if(c==="?")parser.state=S.PROC_INST_ENDING;else parser.procInstBody+=c;continue;case S.PROC_INST_ENDING:if(c===">"){emitNode(parser,"onprocessinginstruction",{name:parser.procInstName,body:parser.procInstBody});parser.procInstName=parser.procInstBody="";parser.state=S.TEXT}else{parser.procInstBody+="?"+c;parser.state=S.PROC_INST_BODY}continue;case S.OPEN_TAG:if(is(nameBody,c))parser.tagName+=c;else{newTag(parser);if(c===">")openTag(parser);else if(c==="/")parser.state=S.OPEN_TAG_SLASH;else{if(not(whitespace,c))strictFail(parser,"Invalid character in tag name");parser.state=S.ATTRIB}}continue;case S.OPEN_TAG_SLASH:if(c===">"){openTag(parser,true);closeTag(parser)}else{strictFail(parser,"Forward-slash in opening tag not followed by >");parser.state=S.ATTRIB}continue;case S.ATTRIB:if(is(whitespace,c))continue;else if(c===">")openTag(parser);else if(c==="/")parser.state=S.OPEN_TAG_SLASH;else if(is(nameStart,c)){parser.attribName=c;parser.attribValue="";parser.state=S.ATTRIB_NAME}else strictFail(parser,"Invalid attribute name");continue;case S.ATTRIB_NAME:if(c==="=")parser.state=S.ATTRIB_VALUE;else if(c===">"){strictFail(parser,"Attribute without value");parser.attribValue=parser.attribName;attrib(parser);openTag(parser)}else if(is(whitespace,c))parser.state=S.ATTRIB_NAME_SAW_WHITE;else if(is(nameBody,c))parser.attribName+=c;else strictFail(parser,"Invalid attribute name");continue;case S.ATTRIB_NAME_SAW_WHITE:if(c==="=")parser.state=S.ATTRIB_VALUE;else if(is(whitespace,c))continue;else{strictFail(parser,"Attribute without value");parser.tag.attributes[parser.attribName]="";parser.attribValue="";emitNode(parser,"onattribute",{name:parser.attribName,value:""});parser.attribName="";if(c===">")openTag(parser);else if(is(nameStart,c)){parser.attribName=c;parser.state=S.ATTRIB_NAME}else{strictFail(parser,"Invalid attribute name");parser.state=S.ATTRIB}}continue;case S.ATTRIB_VALUE:if(is(whitespace,c))continue;else if(is(quote,c)){parser.q=c;parser.state=S.ATTRIB_VALUE_QUOTED}else{strictFail(parser,"Unquoted attribute value");parser.state=S.ATTRIB_VALUE_UNQUOTED;parser.attribValue=c}continue;case S.ATTRIB_VALUE_QUOTED:if(c!==parser.q){if(c==="&")parser.state=S.ATTRIB_VALUE_ENTITY_Q;else parser.attribValue+=c;continue}attrib(parser);parser.q="";parser.state=S.ATTRIB_VALUE_CLOSED;continue;case S.ATTRIB_VALUE_CLOSED:if(is(whitespace,c)){parser.state=S.ATTRIB}else if(c===">")openTag(parser);else if(c==="/")parser.state=S.OPEN_TAG_SLASH;else if(is(nameStart,c)){strictFail(parser,"No whitespace between attributes");parser.attribName=c;parser.attribValue="";parser.state=S.ATTRIB_NAME}else strictFail(parser,"Invalid attribute name");continue;case S.ATTRIB_VALUE_UNQUOTED:if(not(attribEnd,c)){if(c==="&")parser.state=S.ATTRIB_VALUE_ENTITY_U;else parser.attribValue+=c;continue}attrib(parser);if(c===">")openTag(parser);else parser.state=S.ATTRIB;continue;case S.CLOSE_TAG:if(!parser.tagName){if(is(whitespace,c))continue;else if(not(nameStart,c)){if(parser.script){parser.script+="</"+c;parser.state=S.SCRIPT}else{strictFail(parser,"Invalid tagname in closing tag.")}}else parser.tagName=c}else if(c===">")closeTag(parser);else if(is(nameBody,c))parser.tagName+=c;else if(parser.script){parser.script+="</"+parser.tagName;parser.tagName="";parser.state=S.SCRIPT}else{if(not(whitespace,c))strictFail(parser,"Invalid tagname in closing tag");parser.state=S.CLOSE_TAG_SAW_WHITE}continue;case S.CLOSE_TAG_SAW_WHITE:if(is(whitespace,c))continue;if(c===">")closeTag(parser);else strictFail(parser,"Invalid characters in closing tag");continue;case S.TEXT_ENTITY:case S.ATTRIB_VALUE_ENTITY_Q:case S.ATTRIB_VALUE_ENTITY_U:switch(parser.state){case S.TEXT_ENTITY:var returnState=S.TEXT,buffer="textNode";break;case S.ATTRIB_VALUE_ENTITY_Q:var returnState=S.ATTRIB_VALUE_QUOTED,buffer="attribValue";break;case S.ATTRIB_VALUE_ENTITY_U:var returnState=S.ATTRIB_VALUE_UNQUOTED,buffer="attribValue";break}if(c===";"){parser[buffer]+=parseEntity(parser);parser.entity="";parser.state=returnState}else if(is(entity,c))parser.entity+=c;else{strictFail(parser,"Invalid character entity");parser[buffer]+="&"+parser.entity+c;parser.entity="";parser.state=returnState}continue;default:throw new Error(parser,"Unknown state: "+parser.state)}}if(parser.position>=parser.bufferCheckPosition)checkBufferLength(parser);return parser}if(!String.fromCodePoint){(function(){var stringFromCharCode=String.fromCharCode;var floor=Math.floor;var fromCodePoint=function(){var MAX_SIZE=16384;var codeUnits=[];var highSurrogate;var lowSurrogate;var index=-1;var length=arguments.length;if(!length){return""}var result="";while(++index<length){var codePoint=Number(arguments[index]);if(!isFinite(codePoint)||codePoint<0||codePoint>1114111||floor(codePoint)!=codePoint){throw RangeError("Invalid code point: "+codePoint)}if(codePoint<=65535){codeUnits.push(codePoint)}else{codePoint-=65536;highSurrogate=(codePoint>>10)+55296;lowSurrogate=codePoint%1024+56320;codeUnits.push(highSurrogate,lowSurrogate)}if(index+1==length||codeUnits.length>MAX_SIZE){result+=stringFromCharCode.apply(null,codeUnits);codeUnits.length=0}}return result};if(Object.defineProperty){Object.defineProperty(String,"fromCodePoint",{value:fromCodePoint,configurable:true,writable:true})}else{String.fromCodePoint=fromCodePoint}})()}})(typeof exports==="undefined"?sax={}:exports)}).call(this,require("buffer").Buffer)},{buffer:undefined,stream:undefined,string_decoder:undefined}],14:[function(require,module,exports){(function(root,factory){if(typeof exports==="object"){module.exports=factory()}else if(typeof define==="function"&&define.amd){define(factory)}else{root.scion=factory()}})(this,function(){"use strict";var STATE_TYPES={BASIC:0,COMPOSITE:1,PARALLEL:2,HISTORY:3,INITIAL:4,FINAL:5};var ioProcessorTypes={scxml:{location:"http://www.w3.org/TR/scxml/#SCXMLEventProcessor"},basichttp:{location:"http://www.w3.org/TR/scxml/#BasicHTTPEventProcessor"},dom:{location:"http://www.w3.org/TR/scxml/#DOMEventProcessor"},publish:{location:"https://github.com/jbeard4/SCION#publish"}};function initializeModel(rootState){var transitions=[],idToStateMap={},documentOrder=0;var idCount={};function generateId(type){if(idCount[type]===undefined)idCount[type]=0;var count=idCount[type]++;return"$generated-"+type+"-"+count}function wrapInFakeRootState(state){return{$deserializeDatamodel:state.$deserializeDatamodel||function(){},$serializeDatamodel:state.$serializeDatamodel||function(){return null},$idToStateMap:idToStateMap,states:[{$type:"initial",transitions:[{target:state}]},state]}}function normalizeAction(stateOrTransition,actionProperty){var v=stateOrTransition[actionProperty];function normalize(o){if(typeof o==="string"){return eval(o)}else if(typeof o==="function"){return o}else{throw new Error("Unrecognized type of object for actionProperty "+actionProperty)}}if(v!==undefined)stateOrTransition[actionProperty]=Array.isArray(v)?v.map(normalize):[normalize(v)]}var statesWithInitialAttributes=[];function traverse(ancestors,state){if(state.transitions)transitions.push.apply(transitions,state.transitions);if(state.id){if(idToStateMap[state.id])throw new Error("Redefinition of state id "+state.id);idToStateMap[state.id]=state}state.$type=state.$type||"state";state.ancestors=ancestors;state.depth=ancestors.length;state.parent=ancestors[0];state.transitions=state.transitions||[];state.transitions.forEach(function(transition){transition.documentOrder=documentOrder++;transition.source=state});var t2=traverse.bind(null,[state].concat(ancestors));if(state.states)state.states.forEach(t2);switch(state.$type){case"parallel":state.typeEnum=STATE_TYPES.PARALLEL;break;case"initial":state.typeEnum=STATE_TYPES.INITIAL;break;case"history":state.typeEnum=STATE_TYPES.HISTORY;break;case"final":state.typeEnum=STATE_TYPES.FINAL;break;case"state":case"scxml":if(state.states&&state.states.length){state.typeEnum=STATE_TYPES.COMPOSITE}else{state.typeEnum=STATE_TYPES.BASIC}break;default:throw new Error("Unknown state type: "+state.$type)}if(state.states){state.descendants=state.states.concat(state.states.map(function(s){return s.descendants}).reduce(function(a,b){return a.concat(b)},[]))}else{state.descendants=[]}var initialChildren;if(state.typeEnum===STATE_TYPES.COMPOSITE){if(typeof state.initial==="string"){statesWithInitialAttributes.push(state)}else{initialChildren=state.states.filter(function(child){return child.$type==="initial"});state.initialRef=initialChildren.length?initialChildren[0]:state.states[0];checkInitialRef(state)}}if(state.typeEnum===STATE_TYPES.COMPOSITE||state.typeEnum===STATE_TYPES.PARALLEL){var historyChildren=state.states.filter(function(s){return s.$type==="history"});state.historyRef=historyChildren[0]}if(!state.id){state.id=generateId(state.$type);idToStateMap[state.id]=state}["onEntry","onExit"].forEach(normalizeAction.bind(this,state))}function checkInitialRef(state){if(!state.initialRef)throw new Error("Unable to locate initial state for composite state: "+state.id)}function connectIntialAttributes(){statesWithInitialAttributes.forEach(function(state){state.initialRef=idToStateMap[state.initial];checkInitialRef(state)})}function connectTransitionGraph(){transitions.forEach(function(t){normalizeAction(t,"onTransition")});transitions.forEach(function(t){if(t.event){t.events=t.event.trim().split(/ +/)}});transitions.forEach(function(t){if(t.targets||typeof t.target==="undefined")return;if(typeof t.target==="string"){var target=idToStateMap[t.target];if(!target)throw new Error("Unable to find target state with id "+t.target);t.target=target;t.targets=[t.target]}else if(Array.isArray(t.target)){t.targets=t.target.map(function(target){if(typeof target==="string"){target=idToStateMap[target];if(!target)throw new Error("Unable to find target state with id "+t.target);return target}else{return target}})}else if(typeof t.target==="object"){t.targets=[t.target]}else{throw new Error("Transition target has unknown type: "+t.target)}});transitions.forEach(function(t){if(t.targets)t.lcca=getLCCA(t.source,t.targets[0]);t.scope=getScope(t)})}function getScope(transition){var transitionIsReallyInternal=transition.type==="internal"&&transition.source.parent&&transition.targets&&transition.targets.every(function(target){return transition.source.descendants.indexOf(target)>-1});if(!transition.targets){return transition.source}else if(transitionIsReallyInternal){return transition.source}else{return transition.lcca}}function getLCCA(s1,s2){var commonAncestors=[];s1.ancestors.forEach(function(anc){if(anc.typeEnum===STATE_TYPES.COMPOSITE&&anc.descendants.indexOf(s2)>-1){commonAncestors.push(anc)}});if(!commonAncestors.length)throw new Error("Could not find LCA for states.");return commonAncestors[0]}var fakeRootState=wrapInFakeRootState(rootState);traverse([],fakeRootState);connectTransitionGraph();connectIntialAttributes();return fakeRootState}function EventEmitter(){this._listeners={};this._listeners["*"]=[]}EventEmitter.prototype.on=function _on(type,listener){if(!Array.isArray(this._listeners[type])){this._listeners[type]=[]}if(this._listeners[type].indexOf(listener)===-1){this._listeners[type].push(listener)}return this};EventEmitter.prototype.once=function _once(type,listener){var self=this;function __once(){for(var args=[],i=0;i<arguments.length;i+=1){args[i]=arguments[i]}self.off(type,__once);listener.apply(self,args)}__once.listener=listener;return this.on(type,__once)};EventEmitter.prototype.off=function _off(type,listener){if(!Array.isArray(this._listeners[type])){return this}if(typeof listener==="undefined"){this._listeners[type]=[];return this}var index=this._listeners[type].indexOf(listener);if(index===-1){for(var i=0;i<this._listeners[type].length;i+=1){if(this._listeners[type][i].listener===listener){index=i;break}}}this._listeners[type].splice(index,1);return this};EventEmitter.prototype.emit=function _emit(type){var args=Array.prototype.slice.call(arguments);var modifiedArgs=args.slice(1);if(Array.isArray(this._listeners[type])){this._listeners[type].forEach(function __emit(listener){listener.apply(this,modifiedArgs)},this)}this._listeners["*"].forEach(function __emit(listener){listener.apply(this,args)},this);return this};function ArraySet(l){l=l||[];this.o=[];l.forEach(function(x){this.add(x)},this)}ArraySet.prototype={add:function(x){if(!this.contains(x))return this.o.push(x)},remove:function(x){var i=this.o.indexOf(x);if(i===-1){return false}else{this.o.splice(i,1)}return true},union:function(l){l=l.iter?l.iter():l;l.forEach(function(x){this.add(x)},this);return this},difference:function(l){l=l.iter?l.iter():l;l.forEach(function(x){this.remove(x)},this);return this},contains:function(x){return this.o.indexOf(x)>-1},iter:function(){return this.o},isEmpty:function(){return!this.o.length},equals:function(s2){var l2=s2.iter();var l1=this.o;return l1.every(function(x){return l2.indexOf(x)>-1})&&l2.every(function(x){return l1.indexOf(x)>-1})},toString:function(){return"Set("+this.o.toString()+")"}};var scxmlPrefixTransitionSelector=function(){var eventNameReCache={};function eventNameToRe(name){return new RegExp("^"+name.replace(/\./g,"\\.")+"(\\.[0-9a-zA-Z]+)*$")}function retrieveEventRe(name){return eventNameReCache[name]?eventNameReCache[name]:eventNameReCache[name]=eventNameToRe(name)}function nameMatch(t,event){return event&&event.name&&(t.events.indexOf("*")>-1?true:t.events.filter(function(tEvent){return retrieveEventRe(tEvent).test(event.name)}).length)}return function(state,event,evaluator){return state.transitions.filter(function(t){return(!t.events||nameMatch(t,event))&&(!t.cond||evaluator(t.cond))})}}();var query={getAncestors:function(s,root){var ancestors,index,state;index=s.ancestors.indexOf(root);if(index>-1){return s.ancestors.slice(0,index)}else{return s.ancestors}},getAncestorsOrSelf:function(s,root){return[s].concat(this.getAncestors(s,root))},getDescendantsOrSelf:function(s){return[s].concat(s.descendants)},isOrthogonalTo:function(s1,s2){return!this.isAncestrallyRelatedTo(s1,s2)&&this.getLCA(s1,s2).typeEnum===STATE_TYPES.PARALLEL},isAncestrallyRelatedTo:function(s1,s2){return this.getAncestorsOrSelf(s2).indexOf(s1)>-1||this.getAncestorsOrSelf(s1).indexOf(s2)>-1},getLCA:function(s1,s2){var commonAncestors=this.getAncestors(s1).filter(function(a){return a.descendants.indexOf(s2)>-1},this);return commonAncestors[0]}};function getTransitionWithHigherSourceChildPriority(_arg){var t1=_arg[0],t2=_arg[1];if(t1.source.depth<t2.source.depth){return t2}else if(t2.source.depth<t1.source.depth){return t1}else{if(t1.documentOrder<t2.documentOrder){return t1}else{return t2}}}function initializeModelGeneratorFn(modelFn,opts,interpreter){opts.x=opts.x||{};var args=["x","sessionid","ioprocessors"].map(function(name){return opts.x["_"+name]=opts[name]}).concat(interpreter.isIn.bind(interpreter));return modelFn.apply(interpreter,args)}function deserializeSerializedConfiguration(serializedConfiguration,idToStateMap){return serializedConfiguration.map(function(id){
var state=idToStateMap[id];if(!state)throw new Error("Error loading serialized configuration. Unable to locate state with id "+id);return state})}function deserializeHistory(serializedHistory,idToStateMap){var o={};Object.keys(serializedHistory).forEach(function(sid){o[sid]=serializedHistory[sid].map(function(id){var state=idToStateMap[id];if(!state)throw new Error("Error loading serialized history. Unable to locate state with id "+id);return state})});return o}var printTrace=false;function BaseInterpreter(modelOrFnGenerator,opts){EventEmitter.call(this);this._scriptingContext=opts.interpreterScriptingContext||(opts.InterpreterScriptingContext?new opts.InterpreterScriptingContext(this):{});var model;if(typeof modelOrFnGenerator==="function"){model=initializeModelGeneratorFn(modelOrFnGenerator,opts,this)}else if(typeof modelOrFnGenerator==="string"){model=JSON.parse(modelOrFnGenerator)}else{model=modelOrFnGenerator}this._model=initializeModel(model);this.opts=opts||{};this.opts.console=opts.console||(typeof console==="undefined"?{log:function(){}}:console);this.opts.Set=this.opts.Set||ArraySet;this.opts.priorityComparisonFn=this.opts.priorityComparisonFn||getTransitionWithHigherSourceChildPriority;this.opts.transitionSelector=this.opts.transitionSelector||scxmlPrefixTransitionSelector;this._scriptingContext.log=this._scriptingContext.log||this.opts.console.log;this._internalEventQueue=[];if(opts.snapshot){this._configuration=new this.opts.Set(deserializeSerializedConfiguration(opts.snapshot[0],this._model.$idToStateMap));this._historyValue=deserializeHistory(opts.snapshot[1],this._model.$idToStateMap);this._isInFinalState=opts.snapshot[2];this._model.$deserializeDatamodel(opts.snapshot[3])}else{this._configuration=new this.opts.Set;this._historyValue={};this._isInFinalState=false}this._x={_sessionId:opts.sessionId||null,_name:model.name||opts.name||null,_ioprocessors:opts.ioprocessors||null}}BaseInterpreter.prototype=extend(beget(EventEmitter.prototype),{start:function(){if(printTrace)this.opts.console.log("performing initial big step");this._configuration.add(this._model.initialRef);this._performBigStep();return this.getConfiguration()},getConfiguration:function(){return this._configuration.iter().map(function(s){return s.id})},getFullConfiguration:function(){return this._configuration.iter().map(function(s){return[s].concat(query.getAncestors(s))},this).reduce(function(a,b){return a.concat(b)},[]).map(function(s){return s.id}).reduce(function(a,b){return a.indexOf(b)>-1?a:a.concat(b)},[])},isIn:function(stateName){return this.getFullConfiguration().indexOf(stateName)>-1},isFinal:function(stateName){return this._isInFinalState},_performBigStep:function(e){if(e)this._internalEventQueue.push(e);var keepGoing=true;while(keepGoing){var currentEvent=this._internalEventQueue.shift()||null;var selectedTransitions=this._performSmallStep(currentEvent);keepGoing=!selectedTransitions.isEmpty()}this._isInFinalState=this._configuration.iter().every(function(s){return s.typeEnum===STATE_TYPES.FINAL})},_performSmallStep:function(currentEvent){if(printTrace)this.opts.console.log("selecting transitions with currentEvent: ",currentEvent);var selectedTransitions=this._selectTransitions(currentEvent);if(printTrace)this.opts.console.log("selected transitions: ",selectedTransitions);if(!selectedTransitions.isEmpty()){if(printTrace)this.opts.console.log("sorted transitions: ",selectedTransitions);var selectedTransitionsWithTargets=new this.opts.Set(selectedTransitions.iter().filter(function(t){return t.targets}));var exitedTuple=this._getStatesExited(selectedTransitionsWithTargets),basicStatesExited=exitedTuple[0],statesExited=exitedTuple[1];var enteredTuple=this._getStatesEntered(selectedTransitionsWithTargets),basicStatesEntered=enteredTuple[0],statesEntered=enteredTuple[1];if(printTrace)this.opts.console.log("basicStatesExited ",basicStatesExited);if(printTrace)this.opts.console.log("basicStatesEntered ",basicStatesEntered);if(printTrace)this.opts.console.log("statesExited ",statesExited);if(printTrace)this.opts.console.log("statesEntered ",statesEntered);var eventsToAddToInnerQueue=new this.opts.Set;if(printTrace)this.opts.console.log("executing state exit actions");var evaluateAction=this._evaluateAction.bind(this,currentEvent);statesExited.forEach(function(state){if(printTrace||this.opts.logStatesEnteredAndExited)this.opts.console.log("exiting ",state.id);this.emit("onExit",state.id);if(state.onExit!==undefined)state.onExit.forEach(evaluateAction);var f;if(state.historyRef){if(state.historyRef.isDeep){f=function(s0){return s0.typeEnum===STATE_TYPES.BASIC&&state.descendants.indexOf(s0)>-1}}else{f=function(s0){return s0.parent===state}}this._historyValue[state.historyRef.id]=statesExited.filter(f)}},this);var sortedTransitions=selectedTransitions.iter().sort(function(t1,t2){return t1.documentOrder-t2.documentOrder});if(printTrace)this.opts.console.log("executing transitition actions");sortedTransitions.forEach(function(transition){var targetIds=transition.targets&&transition.targets.map(function(target){return target.id});this.emit("onTransition",transition.source.id,targetIds);if(transition.onTransition!==undefined)transition.onTransition.forEach(evaluateAction)},this);if(printTrace)this.opts.console.log("executing state enter actions");statesEntered.forEach(function(state){if(printTrace||this.opts.logStatesEnteredAndExited)this.opts.console.log("entering",state.id);this.emit("onEntry",state.id);if(state.onEntry!==undefined)state.onEntry.forEach(evaluateAction)},this);if(printTrace)this.opts.console.log("updating configuration ");if(printTrace)this.opts.console.log("old configuration ",this._configuration);this._configuration.difference(basicStatesExited);this._configuration.union(basicStatesEntered);if(printTrace)this.opts.console.log("new configuration ",this._configuration);if(!eventsToAddToInnerQueue.isEmpty()){if(printTrace)this.opts.console.log("adding triggered events to inner queue ",eventsToAddToInnerQueue);this._internalEventQueue.push(eventsToAddToInnerQueue)}}return selectedTransitions},_evaluateAction:function(currentEvent,actionRef){try{return actionRef.call(this._scriptingContext,currentEvent)}catch(e){var err={tagname:actionRef.tagname,line:actionRef.line,column:actionRef.column,reason:e.message};this._internalEventQueue.push({name:"error.execution",data:err});this.emit("onError",err)}},_getStatesExited:function(transitions){var statesExited=new this.opts.Set;var basicStatesExited=new this.opts.Set;transitions.iter().forEach(function(transition){var scope=transition.scope,desc=scope.descendants;this._configuration.iter().forEach(function(state){if(desc.indexOf(state)>-1){basicStatesExited.add(state);statesExited.add(state);query.getAncestors(state,scope).forEach(function(anc){statesExited.add(anc)})}},this)},this);var sortedStatesExited=statesExited.iter().sort(function(s1,s2){return s2.depth-s1.depth});return[basicStatesExited,sortedStatesExited]},_getStatesEntered:function(transitions){var o={statesToEnter:new this.opts.Set,basicStatesToEnter:new this.opts.Set,statesProcessed:new this.opts.Set,statesToProcess:[]};transitions.iter().forEach(function(transition){transition.targets.forEach(function(target){this._addStateAndAncestors(target,transition.scope,o)},this)},this);var s;while(s=o.statesToProcess.pop()){this._addStateAndDescendants(s,o)}var sortedStatesEntered=o.statesToEnter.iter().sort(function(s1,s2){return s1.depth-s2.depth});return[o.basicStatesToEnter,sortedStatesEntered]},_addStateAndAncestors:function(target,scope,o){this._addStateAndDescendants(target,o);query.getAncestors(target,scope).forEach(function(s){if(s.typeEnum===STATE_TYPES.COMPOSITE){o.statesToEnter.add(s);o.statesProcessed.add(s)}else{this._addStateAndDescendants(s,o)}},this)},_addStateAndDescendants:function(s,o){if(o.statesProcessed.contains(s))return;if(s.typeEnum===STATE_TYPES.HISTORY){if(s.id in this._historyValue){this._historyValue[s.id].forEach(function(stateFromHistory){this._addStateAndAncestors(stateFromHistory,s.parent,o)},this)}else{o.statesToEnter.add(s);o.basicStatesToEnter.add(s)}}else{o.statesToEnter.add(s);if(s.typeEnum===STATE_TYPES.PARALLEL){o.statesToProcess.push.apply(o.statesToProcess,s.states.filter(function(s){return s.typeEnum!==STATE_TYPES.HISTORY}))}else if(s.typeEnum===STATE_TYPES.COMPOSITE){o.statesToProcess.push(s.initialRef)}else if(s.typeEnum===STATE_TYPES.INITIAL||s.typeEnum===STATE_TYPES.BASIC||s.typeEnum===STATE_TYPES.FINAL){o.basicStatesToEnter.add(s)}}o.statesProcessed.add(s)},_selectTransitions:function(currentEvent){if(this.opts.onlySelectFromBasicStates){var states=this._configuration.iter()}else{var statesAndParents=new this.opts.Set;this._configuration.iter().forEach(function(basicState){statesAndParents.add(basicState);query.getAncestors(basicState).forEach(function(ancestor){statesAndParents.add(ancestor)})},this);states=statesAndParents.iter()}var usePrefixMatchingAlgorithm=currentEvent&&currentEvent.name&&currentEvent.name.search(".");var transitionSelector=usePrefixMatchingAlgorithm?scxmlPrefixTransitionSelector:this.opts.transitionSelector;var enabledTransitions=new this.opts.Set;var e=this._evaluateAction.bind(this,currentEvent);states.forEach(function(state){transitionSelector(state,currentEvent,e).forEach(function(t){enabledTransitions.add(t)})});var priorityEnabledTransitions=this._selectPriorityEnabledTransitions(enabledTransitions);if(printTrace)this.opts.console.log("priorityEnabledTransitions",priorityEnabledTransitions);return priorityEnabledTransitions},_selectPriorityEnabledTransitions:function(enabledTransitions){var priorityEnabledTransitions=new this.opts.Set;var tuple=this._getInconsistentTransitions(enabledTransitions),consistentTransitions=tuple[0],inconsistentTransitionsPairs=tuple[1];priorityEnabledTransitions.union(consistentTransitions);if(printTrace)this.opts.console.log("enabledTransitions",enabledTransitions);if(printTrace)this.opts.console.log("consistentTransitions",consistentTransitions);if(printTrace)this.opts.console.log("inconsistentTransitionsPairs",inconsistentTransitionsPairs);if(printTrace)this.opts.console.log("priorityEnabledTransitions",priorityEnabledTransitions);while(!inconsistentTransitionsPairs.isEmpty()){enabledTransitions=new this.opts.Set(inconsistentTransitionsPairs.iter().map(function(t){return this.opts.priorityComparisonFn(t)},this));tuple=this._getInconsistentTransitions(enabledTransitions);consistentTransitions=tuple[0];inconsistentTransitionsPairs=tuple[1];priorityEnabledTransitions.union(consistentTransitions);if(printTrace)this.opts.console.log("enabledTransitions",enabledTransitions);if(printTrace)this.opts.console.log("consistentTransitions",consistentTransitions);if(printTrace)this.opts.console.log("inconsistentTransitionsPairs",inconsistentTransitionsPairs);if(printTrace)this.opts.console.log("priorityEnabledTransitions",priorityEnabledTransitions)}return priorityEnabledTransitions},_getInconsistentTransitions:function(transitions){var allInconsistentTransitions=new this.opts.Set;var inconsistentTransitionsPairs=new this.opts.Set;var transitionList=transitions.iter();if(printTrace)this.opts.console.log("transitions",transitionList);for(var i=0;i<transitionList.length;i++){for(var j=i+1;j<transitionList.length;j++){var t1=transitionList[i];var t2=transitionList[j];if(this._conflicts(t1,t2)){allInconsistentTransitions.add(t1);allInconsistentTransitions.add(t2);inconsistentTransitionsPairs.add([t1,t2])}}}var consistentTransitions=transitions.difference(allInconsistentTransitions);return[consistentTransitions,inconsistentTransitionsPairs]},_conflicts:function(t1,t2){return!this._isArenaOrthogonal(t1,t2)},_isArenaOrthogonal:function(t1,t2){if(printTrace)this.opts.console.log("transition scopes",t1.scope,t2.scope);var isOrthogonal=query.isOrthogonalTo(t1.scope,t2.scope);if(printTrace)this.opts.console.log("transition scopes are orthogonal?",isOrthogonal);return isOrthogonal},registerListener:function(listener){if(listener.onEntry)this.on("onEntry",listener.onEntry);if(listener.onExit)this.on("onExit",listener.onExit);if(listener.onTransition)this.on("onTransition",listener.onTransition);if(listener.onError)this.on("onError",listener.onError)},unregisterListener:function(listener){if(listener.onEntry)this.off("onEntry",listener.onEntry);if(listener.onExit)this.off("onExit",listener.onExit);if(listener.onTransition)this.off("onTransition",listener.onTransition);if(listener.onError)this.off("onError",listener.onError)},getAllTransitionEvents:function(){var events={};function getEvents(state){if(state.transitions){state.transitions.forEach(function(transition){events[transition.event]=true})}if(state.states)state.states.forEach(getEvents)}getEvents(this._model);return Object.keys(events)},getSnapshot:function(){if(this._isStepping)throw new Error("getSnapshot cannot be called while interpreter is executing a big-step");return[this.getConfiguration(),this._serializeHistory(),this._isInFinalState,this._model.$serializeDatamodel()]},_serializeHistory:function(){var o={};Object.keys(this._historyValue).forEach(function(sid){o[sid]=this._historyValue[sid].map(function(state){return state.id})},this);return o}});function Statechart(model,opts){opts=opts||{};opts.ioprocessors={};Object.keys(ioProcessorTypes).forEach(function(processor){opts.ioprocessors[processor]=ioProcessorTypes[processor]});opts.InterpreterScriptingContext=opts.InterpreterScriptingContext||InterpreterScriptingContext;this._isStepping=false;BaseInterpreter.call(this,model,opts)}function beget(o){function F(){}F.prototype=o;return new F}function extend(to,from){Object.keys(from).forEach(function(k){to[k]=from[k]});return to}Statechart.prototype=beget(BaseInterpreter.prototype);Statechart.prototype.gen=function(evtObjOrName,optionalData){var currentEvent;switch(typeof evtObjOrName){case"string":currentEvent={name:evtObjOrName,data:optionalData};break;case"object":if(typeof evtObjOrName.name==="string"){currentEvent=evtObjOrName}else{throw new Error('Event object must have "name" property of type string.')}break;default:throw new Error("First argument to gen must be a string or object.")}if(this._isStepping)throw new Error("Cannot call gen during a big-step");this._isStepping=true;this._performBigStep(currentEvent);this._isStepping=false;return this.getConfiguration()};function InterpreterScriptingContext(interpreter){this._interpreter=interpreter;this._timeoutMap={}}var validateUriRegex=/\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))/i;InterpreterScriptingContext.prototype={raise:function(event){this._interpreter._internalEventQueue.push(event)},send:function(event,options){function validateSend(event,options,sendAction){if(event.target){var targetIsValidUri=validateUriRegex.test(event.target);if(!targetIsValidUri){return this.raise({name:"error.execution",data:"Target is not valid URI",sendid:options.sendid})}}var eventProcessorTypes=Object.keys(ioProcessorTypes).map(function(k){return ioProcessorTypes[k].location});if(eventProcessorTypes.indexOf(event.type)===-1){return this.raise({name:"error.execution",data:"Unsupported event processor type",sendid:options.sendid})}sendAction.call(this,event,options)}function defaultSendAction(event,options){if(typeof setTimeout==="undefined")throw new Error("Default implementation of Statechart.prototype.send will not work unless setTimeout is defined globally.");var timeoutId=setTimeout(this._interpreter.gen.bind(this._interpreter,event),options.delay||0);if(options.sendid)this._timeoutMap[options.sendid]=timeoutId}function publish(){this._interpreter.emit(event.name,event.data)}event.type=event.type||ioProcessorTypes.scxml.location;var sendFn;if(event.type==="https://github.com/jbeard4/SCION#publish"){sendFn=publish}else if(this._interpreter.opts.customSend){sendFn=this._interpreter.opts.customSend}else{sendFn=defaultSendAction}options=options||{};if(printTrace)this._interpreter.opts.console.log("sending event",event.name,"with content",event.data,"after delay",options.delay);validateSend.call(this,event,options,sendFn)},cancel:function(sendid){if(this._interpreter.opts.customCancel){return this._interpreter.opts.customCancel.apply(this,[sendid])}if(typeof clearTimeout==="undefined")throw new Error("Default implementation of Statechart.prototype.cancel will not work unless setTimeout is defined globally.");if(sendid in this._timeoutMap){if(printTrace)this._interpreter.opts.console.log("cancelling ",sendid," with timeout id ",this._timeoutMap[sendid]);clearTimeout(this._timeoutMap[sendid])}}};return{BaseInterpreter:BaseInterpreter,Statechart:Statechart,ArraySet:ArraySet,STATE_TYPES:STATE_TYPES,initializeModel:initializeModel,InterpreterScriptingContext:InterpreterScriptingContext,ioProcessorTypes:ioProcessorTypes}})},{}]},{},[7])(7)});